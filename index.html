<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#080b12">

<!-- Android PWA -->
<meta name="mobile-web-app-capable" content="yes">

<!-- iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="FlightDeck">

<!-- iOS splash/icon - inline PNG via canvas -->
<link rel="apple-touch-icon" id="appleIcon">

<title>FlightDeck</title>
<script>
// ‚îÄ‚îÄ Generate PNG icon for iOS home screen ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(function(){
  var canvas=document.createElement('canvas');
  canvas.width=512;canvas.height=512;
  var ctx=canvas.getContext('2d');
  // Background
  ctx.fillStyle='#080b12';
  ctx.beginPath();ctx.roundRect(0,0,512,512,80);ctx.fill();
  // Cyan circle glow
  var grd=ctx.createRadialGradient(256,256,60,256,256,240);
  grd.addColorStop(0,'rgba(0,212,255,0.15)');
  grd.addColorStop(1,'rgba(0,212,255,0)');
  ctx.fillStyle=grd;ctx.fillRect(0,0,512,512);
  // Plane emoji
  ctx.font='280px serif';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText('‚úà',256,275);
  var dataUrl=canvas.toDataURL('image/png');
  document.getElementById('appleIcon').href=dataUrl;
  // Also inject PWA manifest
  var manifest={
    name:'FlightDeck',
    short_name:'FlightDeck',
    description:'Your personal aviation logbook',
    start_url:window.location.pathname,
    display:'standalone',
    background_color:'#080b12',
    theme_color:'#080b12',
    orientation:'portrait-primary',
    icons:[
      {src:dataUrl,sizes:'512x512',type:'image/png'},
      {src:dataUrl,sizes:'192x192',type:'image/png'}
    ]
  };
  var blob=new Blob([JSON.stringify(manifest)],{type:'application/json'});
  var url=URL.createObjectURL(blob);
  var link=document.createElement('link');
  link.rel='manifest';link.href=url;
  document.head.appendChild(link);
})();

// ‚îÄ‚îÄ Service Worker for offline support ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
if('serviceWorker' in navigator){
  window.addEventListener('load',function(){
    var swCode=`
const CACHE='flightdeck-v1';
const ASSETS=['/'];
self.addEventListener('install',e=>e.waitUntil(caches.open(CACHE).then(c=>c.addAll(ASSETS))));
self.addEventListener('fetch',e=>{
  if(e.request.url.includes('supabase')||e.request.url.includes('aviationstack')||e.request.url.includes('workers.dev')){
    return e.respondWith(fetch(e.request));
  }
  e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));
});
    `;
    var swBlob=new Blob([swCode],{type:'application/javascript'});
    var swUrl=URL.createObjectURL(swBlob);
    navigator.serviceWorker.register(swUrl).catch(function(){});
  });
}
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=Barlow+Condensed:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --black:#080b12;--dark:#0d1220;--card:#111827;--border:#1e2d45;--muted:#1f3050;
  --cyan:#00d4ff;--cyan-dim:#0099bb;--amber:#f59e0b;--green:#10b981;--red:#ef4444;
  --text:#e8f0fe;--text-dim:#7b8fa8;
  --font-display:'Barlow Condensed',sans-serif;--font-mono:'IBM Plex Mono',monospace;
}
body.light-mode{
  --black:#f0f4f8;--dark:#ffffff;--card:#f8fafc;--border:#cbd5e1;--muted:#e2e8f0;
  --text:#0f172a;--text-dim:#64748b;
}
body.light-mode .leaflet-tile-pane{filter:saturate(0.5) brightness(1.05)}
body.light-mode .leaflet-container{background:#e8eef5}
body.light-mode .tab-bar{background:#ffffff}

/* ‚îÄ‚îÄ TRENDS / CHARTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.trend-section{margin-bottom:32px}
.chart-wrap{background:var(--card);border:1px solid var(--border);border-radius:6px;padding:20px;overflow:hidden}
.bar-chart{display:flex;align-items:flex-end;gap:4px;height:160px;margin-top:8px}
.bar-col{display:flex;flex-direction:column;align-items:center;flex:1;min-width:0;gap:4px}
.bar-fill{width:100%;border-radius:3px 3px 0 0;transition:height 0.5s cubic-bezier(.4,0,.2,1);min-height:2px;cursor:pointer;position:relative}
.bar-fill:hover{opacity:0.8}
.bar-label{font-family:var(--font-mono);font-size:0.5rem;color:var(--text-dim);text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%}
.bar-val{font-family:var(--font-mono);font-size:0.55rem;color:var(--text-dim);text-align:center}
.line-chart{position:relative;height:160px;margin-top:8px}
.line-chart svg{width:100%;height:100%}
.donut-wrap{display:flex;align-items:center;gap:20px;flex-wrap:wrap}
.donut-svg{flex-shrink:0}
.donut-legend{display:flex;flex-direction:column;gap:6px;flex:1;min-width:120px}
.donut-item{display:flex;align-items:center;gap:8px;font-size:0.85rem}
.donut-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.donut-pct{font-family:var(--font-mono);font-size:0.65rem;color:var(--text-dim);margin-left:auto}
.heatmap{display:grid;grid-template-columns:repeat(12,1fr);gap:4px;margin-top:8px}
.heat-cell{border-radius:3px;padding:6px 2px;text-align:center;font-family:var(--font-mono);font-size:0.55rem;color:var(--text-dim);transition:transform 0.15s}
.heat-cell:hover{transform:scale(1.1)}
.yoy-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin-top:8px}
.yoy-card{background:var(--dark);border:1px solid var(--border);border-radius:6px;padding:12px 14px}
.yoy-year{font-family:var(--font-mono);font-size:0.6rem;color:var(--text-dim);letter-spacing:0.12em;margin-bottom:4px}
.yoy-flights{font-size:1.8rem;font-weight:700;color:var(--cyan);line-height:1}
.yoy-miles{font-family:var(--font-mono);font-size:0.62rem;color:var(--text-dim);margin-top:2px}
.leaderboard{display:flex;flex-direction:column;gap:6px;margin-top:8px}
.lb-item{display:flex;align-items:center;gap:10px;padding:8px 10px;background:var(--dark);border:1px solid var(--border);border-radius:5px}
.lb-rank{font-family:var(--font-mono);font-size:0.65rem;color:var(--text-dim);width:20px;flex-shrink:0}
.lb-route{font-weight:700;font-size:0.95rem;flex:1}
.lb-detail{font-family:var(--font-mono);font-size:0.62rem;color:var(--text-dim);text-align:right}
.ap-rank-item{display:flex;align-items:center;gap:10px;padding:7px 10px;background:var(--dark);border:1px solid var(--border);border-radius:5px}
.ap-rank-name{flex:1;font-size:0.9rem}
.ap-rank-code{font-family:var(--font-mono);font-size:0.62rem;color:var(--cyan);width:36px}
.ap-rank-bar{flex:2;height:4px;background:var(--muted);border-radius:2px;overflow:hidden}
.ap-rank-fill{height:100%;background:var(--cyan);border-radius:2px}
.ap-rank-cnt{font-family:var(--font-mono);font-size:0.62rem;color:var(--text-dim);width:28px;text-align:right}

/* ‚îÄ‚îÄ DATE RANGE FILTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.date-filter-row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
.date-filter-row input[type=date]{background:var(--card);border:1px solid var(--border);color:var(--text);font-family:var(--font-mono);font-size:0.75rem;border-radius:4px;padding:8px 12px;outline:none;transition:border-color 0.2s;min-width:0;flex:1}
.date-filter-row input[type=date]:focus{border-color:var(--cyan-dim)}
.date-chips{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px}
.date-chip{font-family:var(--font-mono);font-size:0.62rem;letter-spacing:0.08em;text-transform:uppercase;padding:5px 12px;border-radius:20px;border:1px solid var(--border);background:none;color:var(--text-dim);cursor:pointer;transition:all 0.15s;white-space:nowrap}
.date-chip:hover{border-color:var(--cyan-dim);color:var(--text)}
.date-chip.active{background:rgba(0,212,255,0.12);border-color:var(--cyan);color:var(--cyan)}
html{scroll-behavior:smooth;-webkit-text-size-adjust:100%}
body{background:var(--black);color:var(--text);font-family:var(--font-display);font-size:16px;min-height:100vh;min-height:-webkit-fill-available;overflow-x:hidden;-webkit-tap-highlight-color:transparent;-webkit-overflow-scrolling:touch}
/* Safe area padding for notch/dynamic island/home indicator */
.site-header{padding-top:max(32px,env(safe-area-inset-top))}
.tab-bar{padding-left:max(24px,env(safe-area-inset-left));padding-right:max(24px,env(safe-area-inset-right))}
.main{padding-bottom:max(60px,calc(env(safe-area-inset-bottom) + 60px))}
.bottom-sheet{padding-bottom:env(safe-area-inset-bottom)}
#addFlightBtn{bottom:max(24px,calc(env(safe-area-inset-bottom) + 16px))}
/* Fix iOS input zoom (font must be >= 16px) */
input[type=text],input[type=email],input[type=password],input[type=number],input[type=date],select{font-size:16px!important}
/* Fix iOS momentum scrolling */
.table-wrap,.bottom-sheet,.modal{-webkit-overflow-scrolling:touch}
/* Fix iOS button styles */
button{-webkit-appearance:none;appearance:none}
/* Prevent iOS double-tap zoom */
*{touch-action:manipulation}
.site-header{position:relative;padding:32px 40px 20px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(0,212,255,0.04) 0%,transparent 100%);display:flex;align-items:flex-end;justify-content:space-between;gap:20px;flex-wrap:wrap}
.header-title h1{font-size:clamp(2.5rem,6vw,4.5rem);font-weight:800;letter-spacing:-0.02em;line-height:1;text-transform:uppercase}
.header-title h1 span{color:var(--cyan)}
.header-title p{font-family:var(--font-mono);font-size:0.72rem;color:var(--text-dim);margin-top:8px;letter-spacing:0.1em;text-transform:uppercase}
.header-stats{display:flex;gap:24px;flex-wrap:wrap}
.hstat{text-align:right}
.hstat-val{font-size:clamp(1.6rem,3vw,2.2rem);font-weight:700;color:var(--cyan);line-height:1}
.hstat-lbl{font-family:var(--font-mono);font-size:0.62rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.12em;margin-top:3px}
.sync-status{position:fixed;top:16px;right:16px;z-index:9998;font-family:var(--font-mono);font-size:0.62rem;letter-spacing:0.1em;padding:6px 12px;border-radius:4px;border:1px solid var(--border);background:var(--dark);color:var(--text-dim);display:flex;align-items:center;gap:6px;transition:all 0.3s}
.sync-dot{width:7px;height:7px;border-radius:50%;background:var(--text-dim);flex-shrink:0}
.sync-status.connected .sync-dot{background:var(--green);box-shadow:0 0 6px var(--green)}
.sync-status.connected{color:var(--green);border-color:rgba(16,185,129,0.3)}
.sync-status.syncing .sync-dot{background:var(--amber);animation:pulse 1s infinite}
.sync-status.syncing{color:var(--amber);border-color:rgba(245,158,11,0.3)}
.sync-status.error .sync-dot{background:var(--red)}
.sync-status.error{color:var(--red);border-color:rgba(239,68,68,0.3)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}
.map-section{position:relative;height:520px;border-bottom:1px solid var(--border)}
.map-label{position:absolute;top:16px;left:20px;z-index:1000;background:rgba(8,11,18,0.85);backdrop-filter:blur(8px);border:1px solid var(--border);border-radius:4px;padding:8px 14px;font-family:var(--font-mono);font-size:0.65rem;letter-spacing:0.12em;color:var(--cyan);text-transform:uppercase}
#map{width:100%;height:100%}
.leaflet-tile-pane{filter:saturate(0.2) brightness(0.55) hue-rotate(200deg)}
.leaflet-container{background:#06090f}
.airport-popup .leaflet-popup-content-wrapper{background:var(--dark);border:1px solid var(--border);border-radius:6px;color:var(--text);font-family:var(--font-display)}
.airport-popup .leaflet-popup-tip{background:var(--dark)}
.ap-name{font-size:1.1rem;font-weight:700;color:var(--cyan)}
.ap-code{font-family:var(--font-mono);font-size:0.7rem;color:var(--text-dim)}
.ap-stats{margin-top:6px;font-size:0.85rem;color:var(--text-dim)}
.ap-stats b{color:var(--text)}
.map-legend{position:absolute;bottom:24px;right:16px;z-index:1000;background:rgba(8,11,18,0.85);backdrop-filter:blur(8px);border:1px solid var(--border);border-radius:4px;padding:10px 14px;font-family:var(--font-mono);font-size:0.6rem;color:var(--text-dim)}
.legend-item{display:flex;align-items:center;gap:8px;margin-bottom:4px}
.legend-item:last-child{margin-bottom:0}
.legend-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.main{max-width:1600px;margin:0 auto;padding:32px 24px 60px}
.btn{display:inline-flex;align-items:center;gap:7px;font-family:var(--font-mono);font-size:0.7rem;letter-spacing:0.1em;text-transform:uppercase;border:none;border-radius:4px;padding:10px 18px;cursor:pointer;transition:all 0.15s;white-space:nowrap;font-weight:600}
.btn-cyan{background:var(--cyan);color:var(--black)}
.btn-cyan:hover{background:#33ddff;transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,212,255,0.3)}
.btn-ghost{background:var(--muted);color:var(--text-dim);font-weight:400}
.btn-ghost:hover{background:#2a4060;color:var(--text)}
.btn-danger{background:var(--red);color:#fff}
.btn-danger:hover{background:#f87171}
.btn-del{background:none;border:1px solid transparent;color:var(--text-dim);cursor:pointer;border-radius:3px;padding:3px 8px;font-size:0.8rem;transition:all 0.15s;line-height:1}
.btn-del:hover{background:rgba(239,68,68,0.15);border-color:rgba(239,68,68,0.4);color:var(--red)}
.search-bar{display:flex;gap:12px;margin-bottom:28px;flex-wrap:wrap;align-items:center}
.search-wrap{position:relative;flex:1;min-width:240px}
.search-wrap svg{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--text-dim);pointer-events:none}
input[type=text],select{background:var(--card);border:1px solid var(--border);color:var(--text);font-family:var(--font-mono);font-size:0.8rem;border-radius:4px;padding:11px 16px;width:100%;outline:none;transition:border-color 0.2s}
input[type=text]:focus,select:focus{border-color:var(--cyan-dim)}
input::placeholder{color:var(--text-dim)}
#searchInput{padding-left:42px}
select{cursor:pointer;min-width:160px;width:auto;appearance:none;padding-right:32px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%237b8fa8' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}
select option{background:var(--dark)}
.search-count{font-family:var(--font-mono);font-size:0.72rem;color:var(--text-dim);white-space:nowrap;align-self:center;min-width:90px;text-align:right}
.search-count span{color:var(--cyan)}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:28px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:6px;padding:16px 18px;transition:border-color 0.2s}
.stat-card:hover{border-color:var(--muted)}
.stat-label{font-family:var(--font-mono);font-size:0.6rem;text-transform:uppercase;letter-spacing:0.14em;color:var(--text-dim);margin-bottom:6px}
.stat-value{font-size:2rem;font-weight:700;line-height:1;color:var(--text)}
.stat-value.cyan{color:var(--cyan)}.stat-value.amber{color:var(--amber)}.stat-value.green{color:var(--green)}
.stat-sub{font-family:var(--font-mono);font-size:0.62rem;color:var(--text-dim);margin-top:4px}
.airline-section{margin-bottom:28px}
.section-title{font-family:var(--font-mono);font-size:0.65rem;text-transform:uppercase;letter-spacing:0.15em;color:var(--text-dim);margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.airline-bars{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:8px}
.airline-bar-item{display:flex;align-items:center;gap:10px;cursor:pointer;padding:5px 6px;border-radius:4px;transition:background 0.15s}
.airline-bar-item:hover{background:var(--muted)}.airline-bar-item.active{background:rgba(0,212,255,0.1)}
.airline-name{font-size:0.95rem;font-weight:600;width:90px;flex-shrink:0}
.airline-track{flex:1;height:6px;background:var(--muted);border-radius:3px;overflow:hidden}
.airline-fill{height:100%;border-radius:3px;transition:width 0.6s cubic-bezier(.4,0,.2,1)}
.airline-count{font-family:var(--font-mono);font-size:0.68rem;color:var(--text-dim);width:50px;text-align:right;flex-shrink:0}
.al-American{background:#cc0000}.al-United{background:#005daa}.al-Delta{background:#c01933}
.al-Southwest{background:#f5a623}.al-Frontier{background:#00a94f}.al-Emirates{background:#d71921}
.al-IndiGo{background:#1a0dab}.al-Qatar{background:#5c0632}
.table-wrap{overflow-x:auto;border:1px solid var(--border);border-radius:6px;background:var(--card)}
table{width:100%;border-collapse:collapse;font-size:0.88rem}
thead tr{border-bottom:2px solid var(--border);background:var(--dark)}
th{font-family:var(--font-mono);font-size:0.6rem;text-transform:uppercase;letter-spacing:0.12em;color:var(--text-dim);padding:12px 14px;text-align:left;white-space:nowrap;cursor:pointer;user-select:none}
th:hover{color:var(--cyan)}
th.sort-asc::after{content:' \2191';color:var(--cyan)}
th.sort-desc::after{content:' \2193';color:var(--cyan)}
tbody tr{border-bottom:1px solid rgba(30,45,69,0.5);transition:background 0.12s}
tbody tr:last-child{border-bottom:none}
tbody tr:hover{background:rgba(0,212,255,0.04)}
td{padding:10px 14px;white-space:nowrap;vertical-align:middle}
.td-num{font-family:var(--font-mono);font-size:0.65rem;color:var(--text-dim)}
.td-date{font-family:var(--font-mono);font-size:0.72rem;color:var(--text-dim)}
.route-cell{display:flex;align-items:center;gap:6px;font-weight:700;font-size:1rem}
.route-arrow{color:var(--text-dim);font-size:0.7rem}
.airline-badge{display:inline-block;font-family:var(--font-mono);font-size:0.6rem;padding:2px 7px;border-radius:3px;text-transform:uppercase;letter-spacing:0.05em}
.badge-American{background:rgba(204,0,0,0.2);color:#ff7070}
.badge-United{background:rgba(0,93,170,0.25);color:#6ab4f5}
.badge-Delta{background:rgba(192,25,51,0.2);color:#ff6a7a}
.badge-Southwest{background:rgba(245,166,35,0.2);color:#ffc85a}
.badge-Frontier{background:rgba(0,169,79,0.2);color:#5de89a}
.badge-Emirates{background:rgba(215,25,33,0.2);color:#ff8888}
.badge-IndiGo{background:rgba(26,13,171,0.25);color:#8899ff}
.badge-Qatar{background:rgba(92,6,50,0.35);color:#ff88cc}
.fn-cell{font-family:var(--font-mono);font-size:0.72rem;color:var(--text-dim)}
.ac-cell{font-size:0.82rem;color:var(--text-dim)}
.km-cell{font-family:var(--font-mono);font-size:0.75rem}
.h-cell{font-family:var(--font-mono);font-size:0.75rem;color:var(--amber)}
.comment-cell{font-size:0.78rem;color:var(--text-dim);max-width:200px;white-space:normal;line-height:1.3}
.no-results{padding:60px;text-align:center;color:var(--text-dim);font-family:var(--font-mono);font-size:0.8rem;letter-spacing:0.1em}
.loading-screen{position:fixed;inset:0;z-index:9999;background:var(--black);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;transition:opacity 0.5s}
.loading-screen.hidden{opacity:0;pointer-events:none}
.loading-title{font-size:2rem;font-weight:800;text-transform:uppercase;letter-spacing:0.05em}
.loading-title span{color:var(--cyan)}
.loading-bar{width:240px;height:3px;background:var(--muted);border-radius:2px;overflow:hidden}
.loading-fill{height:100%;background:var(--cyan);border-radius:2px;width:0%;transition:width 0.4s ease}
.loading-msg{font-family:var(--font-mono);font-size:0.65rem;color:var(--text-dim);letter-spacing:0.12em}
.modal-overlay{position:fixed;inset:0;z-index:5000;background:rgba(4,6,12,0.85);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;pointer-events:none;transition:opacity 0.2s}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{background:var(--dark);border:1px solid var(--border);border-radius:8px;width:100%;max-width:720px;max-height:90vh;overflow-y:auto;transform:translateY(24px) scale(0.98);transition:transform 0.25s cubic-bezier(.4,0,.2,1);box-shadow:0 24px 64px rgba(0,0,0,0.7)}
.modal-overlay.open .modal{transform:translateY(0) scale(1)}
.modal-header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px 16px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--dark);z-index:1}
.modal-title{font-size:1.3rem;font-weight:700;text-transform:uppercase;letter-spacing:0.04em}
.modal-title span{color:var(--cyan)}
.modal-close{background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:1.6rem;line-height:1;padding:2px 8px;border-radius:4px;transition:all 0.15s}
.modal-close:hover{color:var(--text);background:var(--muted)}
.modal-body{padding:24px}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.form-grid .full{grid-column:1/-1}
.field{display:flex;flex-direction:column;gap:6px}
.field label{font-family:var(--font-mono);font-size:0.6rem;text-transform:uppercase;letter-spacing:0.14em;color:var(--text-dim)}
.field input,.field select{background:var(--card);border:1px solid var(--border);color:var(--text);font-family:var(--font-mono);font-size:0.8rem;border-radius:4px;padding:10px 14px;width:100%;outline:none;transition:border-color 0.2s}
.field input{padding-left:14px}
.field input:focus,.field select:focus{border-color:var(--cyan-dim)}
.field input::placeholder{color:var(--text-dim)}
.field-hint{font-size:0.58rem;opacity:0.7;font-weight:400}
.field input.err,.field select.err{border-color:var(--red)}
.modal-footer{display:flex;gap:10px;justify-content:flex-end;padding:16px 24px 20px;border-top:1px solid var(--border)}
.confirm-overlay{position:fixed;inset:0;z-index:6000;background:rgba(4,6,12,0.9);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.15s}
.confirm-overlay.open{opacity:1;pointer-events:all}
.confirm-box{background:var(--dark);border:1px solid rgba(239,68,68,0.4);border-radius:8px;padding:28px 32px;max-width:400px;width:100%;text-align:center;transform:scale(0.95);transition:transform 0.15s}
.confirm-overlay.open .confirm-box{transform:scale(1)}
.confirm-box h3{font-size:1.2rem;font-weight:700;margin-bottom:10px}
.confirm-box p{font-family:var(--font-mono);font-size:0.72rem;color:var(--text-dim);margin-bottom:22px;line-height:1.6}
.confirm-actions{display:flex;gap:10px;justify-content:center}
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(80px);z-index:9999;background:var(--green);color:var(--black);font-family:var(--font-mono);font-size:0.72rem;font-weight:600;letter-spacing:0.08em;padding:12px 20px;border-radius:4px;opacity:0;transition:all 0.3s cubic-bezier(.4,0,.2,1);pointer-events:none;max-width:400px;text-align:center;white-space:nowrap}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1}
.toast.error{background:var(--red);color:#fff}
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--dark)}
::-webkit-scrollbar-thumb{background:var(--muted);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--cyan-dim)}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.site-header{animation:fadeUp 0.5s ease both}
.map-section{animation:fadeUp 0.5s 0.1s ease both}

/* ‚îÄ‚îÄ PASSWORD SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.pw-screen{position:fixed;inset:0;z-index:99999;background:var(--black);display:flex;align-items:center;justify-content:center;padding:24px}
.pw-box{background:var(--dark);border:1px solid var(--border);border-radius:10px;padding:48px 40px;max-width:380px;width:100%;text-align:center;box-shadow:0 24px 64px rgba(0,0,0,0.7)}
.pw-icon{font-size:2.4rem;margin-bottom:16px;display:block}
.pw-title{font-size:2rem;font-weight:800;text-transform:uppercase;letter-spacing:0.04em;margin-bottom:6px}
.pw-title span{color:var(--cyan)}
.pw-sub{font-family:var(--font-mono);font-size:0.65rem;color:var(--text-dim);letter-spacing:0.12em;margin-bottom:28px}
.pw-input-wrap{position:relative;margin-bottom:12px}
.pw-input{background:var(--card);border:2px solid var(--border);color:var(--text);font-family:var(--font-mono);font-size:1rem;border-radius:6px;padding:14px 48px 14px 18px;width:100%;outline:none;transition:border-color 0.2s;letter-spacing:0.12em;text-align:center}
.pw-input:focus{border-color:var(--cyan-dim)}
.pw-input.err{border-color:var(--red);animation:shake 0.3s ease}
.pw-toggle{position:absolute;right:14px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:1rem;padding:4px}
.pw-toggle:hover{color:var(--text)}
.pw-btn{width:100%;background:var(--cyan);color:var(--black);font-family:var(--font-mono);font-size:0.75rem;font-weight:700;letter-spacing:0.14em;text-transform:uppercase;border:none;border-radius:6px;padding:14px;cursor:pointer;transition:all 0.15s;margin-bottom:8px}
.pw-btn:hover{background:#33ddff;transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,212,255,0.3)}
.pw-error{font-family:var(--font-mono);font-size:0.65rem;color:var(--red);letter-spacing:0.08em;min-height:16px;margin-top:4px}
@keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.tab-bar{display:flex;align-items:stretch;border-bottom:1px solid var(--border);background:var(--dark);padding:0 24px;gap:0;position:sticky;top:0;z-index:100}
.tab-btn{font-family:var(--font-mono);font-size:0.68rem;letter-spacing:0.14em;text-transform:uppercase;font-weight:600;padding:16px 28px;background:none;border:none;color:var(--text-dim);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;transition:all 0.15s;display:flex;align-items:center;gap:8px;white-space:nowrap}
.tab-btn:hover{color:var(--text)}
.tab-btn.active{color:var(--cyan);border-bottom-color:var(--cyan)}
.tab-btn svg{opacity:0.7}
.tab-btn.active svg{opacity:1}
.tab-panel{display:none}
.tab-panel.active{display:block}
.airport-filter-banner{background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.25);border-radius:6px;padding:10px 16px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;gap:12px;font-family:var(--font-mono);font-size:0.7rem;color:var(--cyan);letter-spacing:0.08em}
.airport-filter-banner button{background:none;border:1px solid rgba(0,212,255,0.35);color:var(--cyan);font-family:var(--font-mono);font-size:0.62rem;letter-spacing:0.1em;text-transform:uppercase;padding:4px 12px;border-radius:3px;cursor:pointer;transition:all 0.15s}
.airport-filter-banner button:hover{background:rgba(0,212,255,0.15)}
#airportBanner{display:none}
/* ‚îÄ‚îÄ MOBILE STYLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
@media(max-width:640px){
  /* Fix full width ‚Äî no overflow */
  html,body{width:100%;overflow-x:hidden}
  .map-section{width:100%;overflow:hidden}

  /* Header ‚Äî compact, stacked cleanly */
  .site-header{
    padding:12px 16px 10px;
    flex-direction:column;
    align-items:flex-start;
    gap:8px;
  }
  .header-title h1{font-size:1.6rem;letter-spacing:0}
  .header-title p{font-size:0.58rem;margin-top:2px}
  /* Stats row ‚Äî scrollable horizontally, no wrap */
  .header-stats{
    display:flex;gap:16px;flex-wrap:nowrap;
    overflow-x:auto;width:100%;
    padding-bottom:4px;
    -webkit-overflow-scrolling:touch;
  }
  .hstat{text-align:left;flex-shrink:0}
  .hstat-val{font-size:1.2rem}
  .hstat-lbl{font-size:0.5rem}
  /* Sign out button ‚Äî small, top right corner */
  .site-header>div{width:100%;display:flex;align-items:center;justify-content:space-between}
  .site-header button[onclick="handleLogout()"]{
    font-size:0.55rem;padding:4px 10px;
    position:absolute;top:12px;right:16px;
  }

  /* Map ‚Äî shorter */
  .map-section{height:240px}

  /* Tab bar ‚Äî compact, no padding issues */
  .tab-bar{padding:0;overflow-x:auto}
  .tab-btn{padding:12px 14px;font-size:0.6rem;gap:5px;flex-shrink:0}
  #themeToggle{padding:12px 10px}

  /* Main padding */
  .main{padding:12px 12px max(80px,calc(env(safe-area-inset-bottom) + 70px))}

  /* Stats grid ‚Äî 2 col */
  .stats-grid{grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px}
  .stat-card{padding:10px 12px}
  .stat-value{font-size:1.5rem}
  .stat-value[style*="1.4rem"]{font-size:1rem!important}

  /* Airline/aircraft bars ‚Äî single col */
  .airline-bars{grid-template-columns:1fr}
  .airline-name{width:70px;font-size:0.8rem}

  /* Search bar ‚Äî stack vertically */
  .search-bar{flex-direction:column;gap:8px;margin-bottom:12px}
  .search-wrap{min-width:unset;width:100%}
  select{min-width:unset;width:100%}
  .search-count{text-align:left;font-size:0.65rem}

  /* Hide Export button on mobile ‚Äî use FAB only */
  #exportBtn{display:none!important}

  /* Date chips ‚Äî wrap nicely */
  .date-chips{gap:6px;margin-bottom:10px}
  .date-chip{font-size:0.58rem;padding:5px 10px}

  /* Date pickers ‚Äî full width side by side */
  .date-filter-row{gap:6px;margin-bottom:12px}
  .date-filter-row input[type=date]{flex:1;font-size:0.75rem;padding:8px 8px;min-width:0}

  /* Hide columns on mobile */
  th.col-fn,td.col-fn,th.col-mfr,td.col-mfr{display:none}

  /* Table */
  table{font-size:0.78rem}
  td,th{padding:8px 6px}
  .route-cell{font-size:0.85rem;gap:3px}
  .km-cell,.h-cell{font-size:0.65rem}
  .comment-cell{max-width:100px;font-size:0.7rem}

  /* Airport banner */
  .airport-filter-banner{font-size:0.6rem;padding:8px 10px}

  /* Sync status ‚Äî top right, tiny */
  .sync-status{font-size:0.52rem;padding:3px 7px;top:6px;right:6px;gap:4px}
  .sync-dot{width:5px;height:5px}

  /* FAB ‚Äî floating add button */
  #addFlightBtn{
    position:fixed;
    bottom:max(24px,calc(env(safe-area-inset-bottom) + 16px));
    right:16px;z-index:400;
    width:52px;height:52px;border-radius:50%;padding:0;
    justify-content:center;box-shadow:0 4px 20px rgba(0,212,255,0.4);
  }
  #addFlightBtn span.btn-label{display:none}

  /* Trends charts ‚Äî better mobile sizing */
  .bar-chart{gap:2px}
  .bar-label{font-size:0.45rem}
  .donut-wrap{flex-direction:column;align-items:center}
  .heatmap{gap:3px}
  .heat-cell{font-size:0.5rem;padding:4px 1px}

  /* Bottom sheet ‚Äî full height on mobile */
  .bottom-sheet{max-height:95vh}
  .sheet-body{padding:12px 16px}
  .sheet-footer{padding:10px 16px max(16px,env(safe-area-inset-bottom))}

  /* Form grid ‚Äî single col on mobile */
  .form-grid{grid-template-columns:1fr;gap:12px}
}

/* ‚îÄ‚îÄ BOTTOM SHEET ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.sheet-overlay{position:fixed;inset:0;z-index:5000;background:rgba(4,6,12,0.7);backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:opacity 0.25s}
.sheet-overlay.open{opacity:1;pointer-events:all}
.bottom-sheet{position:fixed;bottom:0;left:0;right:0;z-index:5001;background:var(--dark);border-top:1px solid var(--border);border-radius:16px 16px 0 0;max-height:92vh;overflow-y:auto;transform:translateY(100%);transition:transform 0.35s cubic-bezier(.4,0,.2,1);box-shadow:0 -8px 40px rgba(0,0,0,0.6)}
.bottom-sheet.open{transform:translateY(0)}
.sheet-handle{width:36px;height:4px;background:var(--muted);border-radius:2px;margin:12px auto 4px}
.sheet-header{display:flex;align-items:center;justify-content:space-between;padding:8px 20px 16px;border-bottom:1px solid var(--border)}
.sheet-title{font-size:1.2rem;font-weight:700;text-transform:uppercase;letter-spacing:0.04em}
.sheet-title span{color:var(--cyan)}
.sheet-close{background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:1.6rem;line-height:1;padding:4px 8px;border-radius:4px}
.sheet-body{padding:16px 20px}
.sheet-footer{display:flex;gap:10px;justify-content:flex-end;padding:12px 20px 28px;border-top:1px solid var(--border);position:sticky;bottom:0;background:var(--dark)}
/* On desktop keep original modal, hide sheet; on mobile reverse */
@media(min-width:641px){
  .sheet-overlay,.bottom-sheet{display:none!important}
}
@media(max-width:640px){
  .modal-overlay{display:none!important}
}
</style>
<body>

<!-- AUTH SCREEN -->
<div class="pw-screen" id="pwScreen">
  <div class="pw-box">
    <span class="pw-icon">‚úà</span>
    <div class="pw-title">Flight<span>Deck</span></div>
    <div class="pw-sub">YOUR PERSONAL AVIATION LOGBOOK</div>
    <div style="display:flex;gap:0;margin-bottom:24px;border:1px solid var(--border);border-radius:6px;overflow:hidden">
      <button id="authTabLogin" onclick="switchAuthTab('login')" style="flex:1;padding:10px;font-family:var(--font-mono);font-size:0.68rem;letter-spacing:0.1em;text-transform:uppercase;border:none;cursor:pointer;background:var(--cyan);color:var(--black);font-weight:700;transition:all 0.15s">Log In</button>
      <button id="authTabSignup" onclick="switchAuthTab('signup')" style="flex:1;padding:10px;font-family:var(--font-mono);font-size:0.68rem;letter-spacing:0.1em;text-transform:uppercase;border:none;cursor:pointer;background:var(--card);color:var(--text-dim);font-weight:400;transition:all 0.15s">Sign Up</button>
    </div>
    <div class="pw-input-wrap">
      <input class="pw-input" type="email" id="authEmail" placeholder="EMAIL ADDRESS" autocomplete="email" spellcheck="false" style="letter-spacing:0.05em;text-align:left;padding-left:18px">
    </div>
    <div class="pw-input-wrap">
      <input class="pw-input" type="password" id="authPassword" placeholder="PASSWORD" autocomplete="current-password" spellcheck="false">
      <button class="pw-toggle" id="pwToggle" tabindex="-1">üëÅ</button>
    </div>
    <div id="authNameWrap" class="pw-input-wrap" style="display:none">
      <input class="pw-input" type="text" id="authName" placeholder="YOUR NAME" autocomplete="name" spellcheck="false" style="letter-spacing:0.05em;text-align:left;padding-left:18px">
    </div>
    <div class="pw-error" id="pwError"></div>
    <button class="pw-btn" id="pwSubmit">LOG IN</button>
  </div>
</div>


<!-- Loading Screen -->
<div class="loading-screen" id="loadingScreen">
  <div class="loading-title">Flight<span>Deck</span></div>
  <div class="loading-bar"><div class="loading-fill" id="loadingFill"></div></div>
  <div class="loading-msg" id="loadingMsg">CONNECTING TO DATABASE...</div>
</div>

<!-- Sync Status -->
<div class="sync-status" id="syncStatus">
  <div class="sync-dot"></div>
  <span id="syncText">CONNECTING</span>
</div>

<header class="site-header">
  <div style="display:flex;align-items:center;justify-content:space-between;width:100%;gap:12px">
    <div class="header-title">
      <h1>Flight<span>Deck</span></h1>
      <p id="headerSub">YOUR PERSONAL AVIATION LOGBOOK</p>
    </div>
    <button onclick="handleLogout()" style="font-family:var(--font-mono);font-size:0.6rem;letter-spacing:0.1em;text-transform:uppercase;background:none;border:1px solid var(--border);color:var(--text-dim);padding:6px 14px;border-radius:4px;cursor:pointer;transition:all 0.15s;flex-shrink:0" onmouseover="this.style.borderColor='var(--red)';this.style.color='var(--red)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-dim)'">Sign Out</button>
  </div>
  <div class="header-stats" id="headerStats"></div>
</header>

<section class="map-section">
  <div class="map-label">&#10022; AIRPORTS VISITED</div>
  <div id="map"></div>
  <div class="map-legend">
    <div class="legend-item"><div class="legend-dot" style="background:var(--cyan)"></div> AIRPORT</div>
    <div class="legend-item"><div class="legend-dot" style="background:rgba(0,212,255,0.4);border:1px solid var(--cyan-dim)"></div> ROUTE ARC</div>
  </div>
</section>

<!-- TAB BAR -->
<div class="tab-bar">
  <button class="tab-btn active" id="tabDashboard" onclick="switchTab('dashboard')">
    <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
    Dashboard
  </button>
  <button class="tab-btn" id="tabFlights" onclick="switchTab('flights')">
    <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
    Flights
  </button>
  <button class="tab-btn" id="tabTrends" onclick="switchTab('trends')">
    <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
    Trends
  </button>
  <div style="flex:1"></div>
  <button class="tab-btn" id="clearAllBtn" onclick="clearAllFilters()" style="color:var(--cyan);opacity:0;pointer-events:none;transition:opacity 0.2s">
    <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
    Clear Filters
  </button>
  <button class="tab-btn" id="themeToggle" onclick="toggleTheme()" title="Toggle light/dark mode" style="padding:14px 16px">
    <span id="themeIcon">‚òÄÔ∏è</span>
  </button>
</div>

<main class="main">

  <!-- Airport filter banner (shared across both tabs) -->
  <div class="airport-filter-banner" id="airportBanner">
    <span>&#9992; Filtered by airport: <strong id="bannerCode"></strong></span>
    <button onclick="clearAirportFilter()">&#10005; Clear</button>
  </div>

  <!-- ‚îÄ‚îÄ HELP BANNER ‚îÄ‚îÄ -->
  <div id="helpBanner" style="background:var(--card);border:1px solid var(--border);border-radius:8px;margin-bottom:20px;overflow:hidden">
    <button onclick="toggleHelp()" style="width:100%;display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:none;border:none;cursor:pointer;font-family:var(--font-mono);font-size:0.68rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--cyan);text-align:left">
      <span style="display:flex;align-items:center;gap:10px">
        <svg width="15" height="15" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
        HOW TO USE FLIGHTDECK
      </span>
      <span id="helpChevron" style="transition:transform 0.2s;display:inline-block">‚ñº</span>
    </button>
    <div id="helpContent" style="display:none;padding:0 18px 18px;border-top:1px solid var(--border)">

      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-top:16px">

        <div style="background:var(--dark);border:1px solid var(--border);border-radius:6px;padding:14px 16px">
          <div style="font-family:var(--font-mono);font-size:0.6rem;color:var(--cyan);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:8px">‚úà Step 1 ‚Äî Find Your Flight</div>
          <p style="font-size:0.88rem;line-height:1.6;color:var(--text-dim)">Go to <strong style="color:var(--text)">FlightRadar24.com</strong> and search for your flight number (e.g. <strong style="color:var(--cyan)">UA1234</strong>). Click your flight and note down the <strong style="color:var(--text)">flight number</strong> and <strong style="color:var(--text)">date</strong>. That's all you need to get started.</p>
        </div>

        <div style="background:var(--dark);border:1px solid var(--border);border-radius:6px;padding:14px 16px">
          <div style="font-family:var(--font-mono);font-size:0.6rem;color:var(--cyan);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:8px">üîç Step 2 ‚Äî Look Up Your Flight</div>
          <p style="font-size:0.88rem;line-height:1.6;color:var(--text-dim)">Tap the <strong style="color:var(--cyan)">+ button</strong> (bottom right on mobile, or Add Flight on desktop). Enter your flight number and date, then hit <strong style="color:var(--text)">Look Up Flight</strong>. FlightDeck will auto-fill route, airline, duration, and distance for you.</p>
        </div>

        <div style="background:var(--dark);border:1px solid var(--border);border-radius:6px;padding:14px 16px">
          <div style="font-family:var(--font-mono);font-size:0.6rem;color:var(--cyan);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:8px">‚úèÔ∏è Step 3 ‚Äî Fill In the Rest</div>
          <p style="font-size:0.88rem;line-height:1.6;color:var(--text-dim)">After the lookup, review the pre-filled details. Optionally add <strong style="color:var(--text)">aircraft type</strong> (e.g. 737-824), <strong style="color:var(--text)">registration</strong> (tail number, found on FlightRadar24), and any personal <strong style="color:var(--text)">notes</strong>. None of these are required.</p>
        </div>

        <div style="background:var(--dark);border:1px solid var(--border);border-radius:6px;padding:14px 16px">
          <div style="font-family:var(--font-mono);font-size:0.6rem;color:var(--cyan);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:8px">üìç Where to Find Aircraft Info</div>
          <p style="font-size:0.88rem;line-height:1.6;color:var(--text-dim)">On <strong style="color:var(--text)">FlightRadar24</strong>, click your flight and scroll down ‚Äî you'll see the <strong style="color:var(--text)">aircraft type</strong> (e.g. Boeing 737-824) and <strong style="color:var(--text)">registration</strong> (e.g. N814NN). The short name is just the family ‚Äî e.g. <strong style="color:var(--cyan)">737</strong>, <strong style="color:var(--cyan)">A320</strong>, <strong style="color:var(--cyan)">E175</strong>.</p>
        </div>

        <div style="background:var(--dark);border:1px solid var(--border);border-radius:6px;padding:14px 16px">
          <div style="font-family:var(--font-mono);font-size:0.6rem;color:var(--cyan);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:8px">üó∫Ô∏è Using the Map & Filters</div>
          <p style="font-size:0.88rem;line-height:1.6;color:var(--text-dim)">Tap any <strong style="color:var(--cyan)">airport dot</strong> on the map to filter all your stats to just that airport. Tap it again or tap the map background to clear. Use the <strong style="color:var(--text)">Clear Filters</strong> button at the top to reset everything.</p>
        </div>

        <div style="background:var(--dark);border:1px solid var(--border);border-radius:6px;padding:14px 16px">
          <div style="font-family:var(--font-mono);font-size:0.6rem;color:var(--cyan);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:8px">üì± Install as an App</div>
          <p style="font-size:0.88rem;line-height:1.6;color:var(--text-dim)"><strong style="color:var(--text)">iPhone:</strong> Open in Safari ‚Üí tap the Share button ‚Üí Add to Home Screen.<br><strong style="color:var(--text)">Android:</strong> Open in Chrome ‚Üí tap the three dots ‚Üí Add to Home Screen. FlightDeck will open full-screen like a native app.</p>
        </div>

      </div>

      <div style="margin-top:14px;padding:12px 14px;background:rgba(0,212,255,0.06);border:1px solid rgba(0,212,255,0.2);border-radius:5px;font-family:var(--font-mono);font-size:0.65rem;color:var(--text-dim);line-height:1.7;letter-spacing:0.04em">
        üí° <strong style="color:var(--cyan)">TIP:</strong> Only your flight number and date are required to save a flight. Everything else is optional ‚Äî add as much or as little detail as you want. The more you fill in, the richer your dashboard becomes!
      </div>

    </div>
  </div>

  <!-- ‚îÄ‚îÄ DASHBOARD TAB ‚îÄ‚îÄ -->
  <div class="tab-panel active" id="panelDashboard">
    <div class="stats-grid" id="statsGrid"></div>
    <div class="airline-section">
      <div class="section-title">AIRLINE BREAKDOWN &mdash; click to filter</div>
      <div class="airline-bars" id="airlineBars"></div>
    </div>
    <div class="airline-section">
      <div class="section-title">AIRCRAFT TYPE BREAKDOWN &mdash; click to filter</div>
      <div class="airline-bars" id="aircraftBars"></div>
    </div>
    <div class="airline-section">
      <div class="section-title">MANUFACTURER BREAKDOWN &mdash; click to filter</div>
      <div class="airline-bars" id="mfrBars"></div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ FLIGHTS TAB ‚îÄ‚îÄ -->
  <div class="tab-panel" id="panelFlights">
    <div class="search-bar">
      <div class="search-wrap">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        <input type="text" id="searchInput" placeholder="Search flights, airports, airlines, aircraft&#x2026;">
      </div>
      <select id="airlineFilter">
        <option value="">All Airlines</option>
        <option>American</option><option>United</option><option>Delta</option>
        <option>Southwest</option><option>Frontier</option><option>Emirates</option>
        <option>IndiGo</option><option>Qatar</option>
      </select>
      <select id="mfrFilter">
        <option value="">All Manufacturers</option>
        <option>Boeing</option><option>Airbus</option><option>Embraer</option>
        <option>Bombardier</option><option>ATR</option>
      </select>
      <div class="search-count">Showing <span id="countShown">0</span> / <span id="countTotal">0</span></div>
      <button class="btn btn-ghost admin-only" id="exportBtn" style="background:var(--muted);color:var(--text-dim)"><svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>EXPORT</button>
      <button class="btn btn-cyan admin-only" id="addFlightBtn">
        <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg>
        <span class="btn-label">ADD FLIGHT</span>
      </button>
    </div>
    <div class="date-chips">
      <button class="date-chip" id="chip-month" onclick="setDateChip('month',this)">This Month</button>
      <button class="date-chip" id="chip-3month" onclick="setDateChip('3month',this)">Last 3 Months</button>
      <button class="date-chip" id="chip-year" onclick="setDateChip('year',this)">This Year</button>
      <button class="date-chip" id="chip-all" onclick="setDateChip('all',this)">All Time</button>
    </div>
    <div class="date-filter-row">
      <input type="date" id="dateFrom" placeholder="From">
      <span style="font-family:var(--font-mono);font-size:0.65rem;color:var(--text-dim)">to</span>
      <input type="date" id="dateTo" placeholder="To">
    </div>
    <div>
      <div class="section-title">COMPLETE FLIGHT LOG</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th data-col="n">#</th>
              <th data-col="date">Date</th>
              <th data-col="dep">Route</th>
              <th data-col="airline">Airline</th>
              <th data-col="fn" class="col-fn">Flight</th>
              <th data-col="ac">Aircraft</th>
              <th data-col="mfr" class="col-mfr">Maker</th>
              <th data-col="km">Distance</th>
              <th data-col="h">Duration</th>
              <th>Notes</th>
              <th class="admin-only"></th>
            </tr>
          </thead>
          <tbody id="flightBody"></tbody>
        </table>
        <div class="no-results" id="noResults" style="display:none">NO FLIGHTS MATCH YOUR SEARCH</div>
      </div>
    </div>
  </div><!-- end panelFlights -->

  <!-- ‚îÄ‚îÄ TRENDS TAB ‚îÄ‚îÄ -->
  <div class="tab-panel" id="panelTrends">
    <div class="trend-section">
      <div class="section-title">FLIGHTS PER MONTH</div>
      <div class="chart-wrap"><div class="bar-chart" id="chartMonthly"></div></div>
    </div>
    <div class="trend-section">
      <div class="section-title">MILES FLOWN OVER TIME</div>
      <div class="chart-wrap"><div class="line-chart" id="chartMiles"><svg id="svgMiles"></svg></div></div>
    </div>
    <div class="trend-section">
      <div class="section-title">AIRLINE LOYALTY</div>
      <div class="chart-wrap"><div class="donut-wrap"><svg class="donut-svg" id="svgDonut" width="140" height="140" viewBox="0 0 140 140"></svg><div class="donut-legend" id="donutLegend"></div></div></div>
    </div>
    <div class="trend-section">
      <div class="section-title">BUSIEST TRAVEL MONTHS</div>
      <div class="chart-wrap"><div class="heatmap" id="heatmap"></div></div>
    </div>
    <div class="trend-section">
      <div class="section-title">YEAR-OVER-YEAR</div>
      <div class="yoy-grid" id="yoyGrid"></div>
    </div>
    <div class="trend-section">
      <div class="section-title">LONGEST FLIGHTS</div>
      <div class="leaderboard" id="lbLongest"></div>
    </div>
    <div class="trend-section">
      <div class="section-title">SHORTEST FLIGHTS</div>
      <div class="leaderboard" id="lbShortest"></div>
    </div>
    <div class="trend-section">
      <div class="section-title">MOST VISITED AIRPORTS</div>
      <div class="leaderboard" id="lbAirports"></div>
    </div>
  </div><!-- end panelTrends -->

</main>

<!-- ADD FLIGHT MODAL (desktop) -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalTitleText">Add <span>New Flight</span></div>
      <button class="modal-close" id="modalCloseBtn">&times;</button>
    </div>
    <div class="modal-body">

      <!-- SCREEN 1: Lookup -->
      <div id="modalScreen1">
        <p style="font-family:var(--font-mono);font-size:0.7rem;color:var(--text-dim);margin-bottom:20px;line-height:1.6">Enter your flight number and date to automatically pull in all the details.</p>
        <div class="form-grid">
          <div class="field"><label>Flight Number *</label><input type="text" id="f-fn-lookup" placeholder="e.g. UA1234" style="text-transform:uppercase"></div>
          <div class="field"><label>Date *</label><input type="date" id="f-date-lookup"></div>
        </div>
        <div id="lookupError" style="font-family:var(--font-mono);font-size:0.65rem;color:var(--red);margin-top:12px;min-height:16px"></div>
        <div style="display:flex;gap:10px;margin-top:20px">
          <button class="btn btn-cyan" id="modalLookupBtn" style="flex:1">
            <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
            LOOK UP FLIGHT
          </button>
          <button class="btn btn-ghost" id="modalManualBtn">ENTER MANUALLY</button>
        </div>
      </div>

      <!-- SCREEN 2: Review / Manual -->
      <div id="modalScreen2" style="display:none">
        <div id="lookupSuccessBanner" style="display:none;background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:5px;padding:10px 14px;margin-bottom:16px;font-family:var(--font-mono);font-size:0.65rem;color:var(--green);letter-spacing:0.08em">‚úì FLIGHT DATA FOUND ‚Äî REVIEW AND SAVE</div>
        <div class="form-grid">
          <div class="field"><label>Date *</label><input type="text" id="f-date" placeholder="Mar 15, 2026"></div>
          <div class="field"><label>Flight Number *</label><input type="text" id="f-fn" placeholder="e.g. UA1234"></div>
          <div class="field"><label>Departing</label><input type="text" id="f-dep" placeholder="MSN" maxlength="4"></div>
          <div class="field"><label>Arriving</label><input type="text" id="f-arr" placeholder="DFW" maxlength="4"></div>
          <div class="field"><label>Airline</label>
            <select id="f-airline">
              <option value="">Select airline&#x2026;</option>
              <option>American</option><option>United</option><option>Delta</option>
              <option>Southwest</option><option>Frontier</option><option>Emirates</option>
              <option>IndiGo</option><option>Qatar</option>
              <option value="__other">Other&#x2026;</option>
            </select>
          </div>
          <div class="field" id="airlineOtherWrap" style="display:none"><label>Airline Name</label><input type="text" id="f-airline-other" placeholder="e.g. Alaska"></div>
          <div class="field"><label>Duration</label>
            <div style="display:flex;gap:8px">
              <div style="position:relative;flex:1"><input type="number" id="f-h-hrs" placeholder="0" min="0" max="24" style="padding-left:14px;text-align:center"><span style="position:absolute;right:10px;top:50%;transform:translateY(-50%);font-family:var(--font-mono);font-size:0.65rem;color:var(--text-dim);pointer-events:none">HRS</span></div>
              <div style="position:relative;flex:1"><input type="number" id="f-h-min" placeholder="0" min="0" max="59" style="padding-left:14px;text-align:center"><span style="position:absolute;right:10px;top:50%;transform:translateY(-50%);font-family:var(--font-mono);font-size:0.65rem;color:var(--text-dim);pointer-events:none">MIN</span></div>
            </div>
          </div>
          <div class="field">
            <label>Distance <span id="f-dist-lbl" style="color:var(--cyan)">MI</span> <span class="field-hint">(optional)</span></label>
            <div style="display:flex;gap:8px">
              <input type="text" id="f-km" placeholder="e.g. 821" style="flex:1">
              <button type="button" id="f-dist-toggle" onclick="toggleDistUnit('f')" style="font-family:var(--font-mono);font-size:0.62rem;letter-spacing:0.08em;text-transform:uppercase;background:var(--muted);border:1px solid var(--border);color:var(--text-dim);padding:0 12px;border-radius:4px;cursor:pointer;white-space:nowrap;flex-shrink:0;transition:all 0.15s">MI</button>
            </div>
          </div>
          <div class="field"><label>Aircraft <span class="field-hint">(optional)</span></label><input type="text" id="f-ac" placeholder="e.g. 737-824"></div>
          <div class="field"><label>Aircraft Short <span class="field-hint">(optional)</span></label><input type="text" id="f-acs" placeholder="e.g. 737"></div>
          <div class="field"><label>Manufacturer <span class="field-hint">(optional)</span></label>
            <select id="f-mfr"><option value="">Select&#x2026;</option><option>Boeing</option><option>Airbus</option><option>Embraer</option><option>Bombardier</option><option>ATR</option><option value="__other">Other&#x2026;</option></select>
          </div>
          <div class="field" id="mfrOtherWrap" style="display:none"><label>Manufacturer Name</label><input type="text" id="f-mfr-other" placeholder="e.g. Cessna"></div>
          <div class="field"><label>Registration <span class="field-hint">(optional)</span></label><input type="text" id="f-reg" placeholder="e.g. N814NN"></div>
          <div class="field full"><label>Notes / Comments <span class="field-hint">(optional)</span></label><input type="text" id="f-comment" placeholder="e.g. First Class, delayed, etc."></div>
        </div>
      </div>

    </div>
    <div class="modal-footer" id="modalFooter" style="display:none">
      <button class="btn btn-ghost" id="modalBackBtn">‚Üê Back</button>
      <button class="btn btn-ghost" id="modalCancelBtn">Cancel</button>
      <button class="btn btn-cyan" id="modalSubmitBtn">
        <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg>
        SAVE FLIGHT
      </button>
    </div>
  </div>
</div>

<!-- BOTTOM SHEET (mobile add flight) -->
<div class="sheet-overlay" id="sheetOverlay"></div>
<div class="bottom-sheet" id="bottomSheet">
  <div class="sheet-handle"></div>
  <div class="sheet-header">
    <div class="sheet-title" id="sheetTitleText">Add <span>Flight</span></div>
    <button class="sheet-close" id="sheetCloseBtn">&times;</button>
  </div>
  <div class="sheet-body">

    <!-- SCREEN 1: Lookup -->
    <div id="sheetScreen1">
      <p style="font-family:var(--font-mono);font-size:0.7rem;color:var(--text-dim);margin-bottom:20px;line-height:1.6">Enter your flight number and date to auto-fill everything.</p>
      <div class="form-grid">
        <div class="field"><label>Flight Number *</label><input type="text" id="sf-fn-lookup" placeholder="e.g. UA1234" style="text-transform:uppercase"></div>
        <div class="field"><label>Date *</label><input type="date" id="sf-date-lookup"></div>
      </div>
      <div id="sLookupError" style="font-family:var(--font-mono);font-size:0.65rem;color:var(--red);margin-top:12px;min-height:16px"></div>
      <div style="display:flex;flex-direction:column;gap:10px;margin-top:20px">
        <button class="btn btn-cyan" id="sheetLookupBtn">
          <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
          LOOK UP FLIGHT
        </button>
        <button class="btn btn-ghost" id="sheetManualBtn">ENTER MANUALLY</button>
      </div>
    </div>

    <!-- SCREEN 2: Review / Manual -->
    <div id="sheetScreen2" style="display:none">
      <div id="sLookupSuccessBanner" style="display:none;background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:5px;padding:10px 14px;margin-bottom:16px;font-family:var(--font-mono);font-size:0.65rem;color:var(--green);letter-spacing:0.08em">‚úì FLIGHT DATA FOUND ‚Äî REVIEW AND SAVE</div>
      <div class="form-grid">
        <div class="field"><label>Date *</label><input type="text" id="sf-date" placeholder="Mar 15, 2026"></div>
        <div class="field"><label>Flight Number *</label><input type="text" id="sf-fn" placeholder="e.g. UA1234"></div>
        <div class="field"><label>Departing</label><input type="text" id="sf-dep" placeholder="MSN" maxlength="4"></div>
        <div class="field"><label>Arriving</label><input type="text" id="sf-arr" placeholder="DFW" maxlength="4"></div>
        <div class="field"><label>Airline</label>
          <select id="sf-airline">
            <option value="">Select airline&#x2026;</option>
            <option>American</option><option>United</option><option>Delta</option>
            <option>Southwest</option><option>Frontier</option><option>Emirates</option>
            <option>IndiGo</option><option>Qatar</option>
            <option value="__other">Other&#x2026;</option>
          </select>
        </div>
        <div class="field" id="sAirlineOtherWrap" style="display:none"><label>Airline Name</label><input type="text" id="sf-airline-other" placeholder="e.g. Alaska"></div>
        <div class="field"><label>Duration</label>
          <div style="display:flex;gap:8px">
            <div style="position:relative;flex:1"><input type="number" id="sf-h-hrs" placeholder="0" min="0" max="24" style="text-align:center;padding-right:36px"><span style="position:absolute;right:10px;top:50%;transform:translateY(-50%);font-family:var(--font-mono);font-size:0.65rem;color:var(--text-dim);pointer-events:none">HRS</span></div>
            <div style="position:relative;flex:1"><input type="number" id="sf-h-min" placeholder="0" min="0" max="59" style="text-align:center;padding-right:36px"><span style="position:absolute;right:10px;top:50%;transform:translateY(-50%);font-family:var(--font-mono);font-size:0.65rem;color:var(--text-dim);pointer-events:none">MIN</span></div>
          </div>
        </div>
        <div class="field">
            <label>Distance <span id="sf-dist-lbl" style="color:var(--cyan)">MI</span> <span class="field-hint">(optional)</span></label>
            <div style="display:flex;gap:8px">
              <input type="text" id="sf-km" placeholder="e.g. 821" style="flex:1">
              <button type="button" id="sf-dist-toggle" onclick="toggleDistUnit('sf')" style="font-family:var(--font-mono);font-size:0.62rem;letter-spacing:0.08em;text-transform:uppercase;background:var(--muted);border:1px solid var(--border);color:var(--text-dim);padding:0 12px;border-radius:4px;cursor:pointer;white-space:nowrap;flex-shrink:0;transition:all 0.15s">MI</button>
            </div>
          </div>
        <div class="field"><label>Aircraft <span class="field-hint">(optional)</span></label><input type="text" id="sf-ac" placeholder="e.g. 737-824"></div>
        <div class="field"><label>Aircraft Short <span class="field-hint">(optional)</span></label><input type="text" id="sf-acs" placeholder="e.g. 737"></div>
        <div class="field"><label>Manufacturer <span class="field-hint">(optional)</span></label>
          <select id="sf-mfr"><option value="">Select&#x2026;</option><option>Boeing</option><option>Airbus</option><option>Embraer</option><option>Bombardier</option><option>ATR</option><option value="__other">Other&#x2026;</option></select>
        </div>
        <div class="field" id="sMfrOtherWrap" style="display:none"><label>Manufacturer Name</label><input type="text" id="sf-mfr-other" placeholder="e.g. Cessna"></div>
        <div class="field"><label>Registration <span class="field-hint">(optional)</span></label><input type="text" id="sf-reg" placeholder="e.g. N814NN"></div>
        <div class="field full"><label>Notes <span class="field-hint">(optional)</span></label><input type="text" id="sf-comment" placeholder="e.g. First Class, delayed, etc."></div>
      </div>
    </div>

  </div>
  <div class="sheet-footer">
    <button class="btn btn-ghost" id="sheetBackBtn" style="display:none">‚Üê Back</button>
    <button class="btn btn-ghost" id="sheetCancelBtn">Cancel</button>
    <button class="btn btn-cyan" id="sheetSubmitBtn" style="display:none">
      <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg>
      SAVE FLIGHT
    </button>
  </div>
</div>
<div class="confirm-overlay" id="confirmOverlay">
  <div class="confirm-box">
    <h3>Delete Flight?</h3>
    <p id="confirmMsg">This will remove this flight from your log.</p>
    <div class="confirm-actions">
      <button class="btn btn-ghost" id="confirmCancelBtn">Cancel</button>
      <button class="btn btn-danger" id="confirmDeleteBtn">DELETE</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const SUPABASE_URL = 'https://sqggnktltpodmytlvray.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNxZ2dua3RsdHBvZG15dGx2cmF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3MDMzOTUsImV4cCI6MjA4NzI3OTM5NX0.gJbWbp6q0bE2XTIdxng3WxigP6VRnuS5m9eZdVeEm98';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// Seed data for first-time migration
let FLIGHTS = [
  {n:1,date:"May 17, 2024",airline:"Southwest",fn:"WN250",dep:"DEN",arr:"SJC",ac:"737-8H4",acs:"737",mfr:"Boeing",reg:"N8539V",h:2.12,km:1526,comment:""},
  {n:2,date:"May 31, 2024",airline:"Frontier",fn:"F91094",dep:"SFO",arr:"DEN",ac:"A320-251N",acs:"A320",mfr:"Airbus",reg:"N343FR",h:2.07,km:1556,comment:""},
  {n:3,date:"Jun 01, 2024",airline:"Frontier",fn:"F91093",dep:"DEN",arr:"SFO",ac:"A320-251N",acs:"A320",mfr:"Airbus",reg:"N316FR",h:2.33,km:1556,comment:""},
  {n:4,date:"Jun 11, 2024",airline:"Frontier",fn:"F94000",dep:"SFO",arr:"DFW",ac:"A320-214",acs:"A320",mfr:"Airbus",reg:"N238FR",h:3.02,km:2357,comment:""},
  {n:5,date:"Jun 20, 2024",airline:"American",fn:"AA227",dep:"SJC",arr:"DFW",ac:"737-824",acs:"737",mfr:"Boeing",reg:"N814NN",h:2.87,km:2315,comment:""},
  {n:6,date:"Jun 20, 2024",airline:"American",fn:"AA1736",dep:"DFW",arr:"MSN",ac:"A319-132",acs:"A319",mfr:"Airbus",reg:"N816AW",h:1.75,km:1321,comment:""},
  {n:7,date:"Jun 22, 2024",airline:"United",fn:"UA1784",dep:"MSN",arr:"DEN",ac:"A319-131",acs:"A319",mfr:"Airbus",reg:"N829UA",h:2.28,km:1329,comment:""},
  {n:8,date:"Jun 22, 2024",airline:"United",fn:"UA1786",dep:"DEN",arr:"SJC",ac:"A320-232",acs:"A320",mfr:"Airbus",reg:"N484UA",h:2.05,km:1526,comment:""},
  {n:9,date:"Jun 24, 2024",airline:"Qatar",fn:"QR738",dep:"SFO",arr:"DOH",ac:"A350-1041",acs:"A350",mfr:"Airbus",reg:"A7-ANO",h:14.80,km:13014,comment:""},
  {n:10,date:"Jun 25, 2024",airline:"Qatar",fn:"QR528",dep:"DOH",arr:"MAA",ac:"787-8",acs:"787",mfr:"Boeing",reg:"A7-BCF",h:4.22,km:3289,comment:""},
  {n:11,date:"Jun 29, 2024",airline:"IndiGo",fn:"6E7179",dep:"MAA",arr:"TCR",ac:"ATR 72-600",acs:"ATR 72",mfr:"ATR",reg:"VT-IYK",h:1.38,km:528,comment:""},
  {n:12,date:"Jul 03, 2024",airline:"IndiGo",fn:"6E7264",dep:"TCR",arr:"MAA",ac:"ATR 72-600",acs:"ATR 72",mfr:"ATR",reg:"VT-IYO",h:1.60,km:528,comment:""},
  {n:13,date:"Jul 04, 2024",airline:"IndiGo",fn:"6E1321",dep:"MAA",arr:"DOH",ac:"A320-232",acs:"A320",mfr:"Airbus",reg:"VT-IFL",h:3.98,km:3289,comment:""},
  {n:14,date:"Jul 04, 2024",airline:"Qatar",fn:"QR737",dep:"DOH",arr:"SFO",ac:"A350-1041",acs:"A350",mfr:"Airbus",reg:"A7-ANL",h:14.53,km:13014,comment:""},
  {n:15,date:"Jul 20, 2024",airline:"United",fn:"UA1999",dep:"SJC",arr:"DEN",ac:"737-824",acs:"737",mfr:"Boeing",reg:"N33262",h:2.07,km:1526,comment:""},
  {n:16,date:"Jul 27, 2024",airline:"United",fn:"UA1839",dep:"DEN",arr:"SJC",ac:"737-924(ER)",acs:"737",mfr:"Boeing",reg:"N69816",h:2.18,km:1526,comment:""},
  {n:17,date:"Sep 21, 2024",airline:"American",fn:"AA2621",dep:"MKE",arr:"DFW",ac:"A320-214",acs:"A320",mfr:"Airbus",reg:"N114UW",h:2.08,km:1372,comment:""},
  {n:18,date:"Sep 23, 2024",airline:"American",fn:"AA1234",dep:"DFW",arr:"MKE",ac:"A319-132",acs:"A319",mfr:"Airbus",reg:"N827AW",h:1.92,km:1372,comment:"Delayed by 10 hours 49 Mins"},
  {n:19,date:"Sep 30, 2024",airline:"American",fn:"AA5297",dep:"MSN",arr:"CLT",ac:"CRJ-900LR",acs:"CRJ-900",mfr:"Bombardier",reg:"N618NN",h:1.67,km:1139,comment:"American Eagle; PSA Airlines"},
  {n:20,date:"Sep 30, 2024",airline:"American",fn:"AA5357",dep:"CLT",arr:"ORF",ac:"CRJ-900LR",acs:"CRJ-900",mfr:"Bombardier",reg:"N547NN",h:0.77,km:466,comment:"American Eagle; PSA Airlines"},
  {n:21,date:"Oct 04, 2024",airline:"Southwest",fn:"WN4582",dep:"ORF",arr:"BWI",ac:"737-7H4",acs:"737",mfr:"Boeing",reg:"N238WN",h:0.65,km:257,comment:"American got cancelled again"},
  {n:22,date:"Oct 04, 2024",airline:"Southwest",fn:"WN3588",dep:"BWI",arr:"MKE",ac:"737-8H4",acs:"737",mfr:"Boeing",reg:"N8519R",h:1.73,km:1032,comment:""},
  {n:23,date:"Oct 07, 2024",airline:"United",fn:"UA1784",dep:"MSN",arr:"DEN",ac:"737 MAX 8",acs:"737",mfr:"Boeing",reg:"N17333",h:2.03,km:1329,comment:""},
  {n:24,date:"Oct 07, 2024",airline:"United",fn:"UA5414",dep:"DEN",arr:"MRY",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N203SY",h:2.15,km:1544,comment:"United Express; Skywest Airlines"},
  {n:25,date:"Oct 10, 2024",airline:"United",fn:"UA5401",dep:"MRY",arr:"DEN",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N142SY",h:2.20,km:1544,comment:"United Express; Skywest Airlines"},
  {n:26,date:"Oct 10, 2024",airline:"United",fn:"UA1382",dep:"DEN",arr:"MSN",ac:"737 MAX 8",acs:"737",mfr:"Boeing",reg:"N17264",h:1.78,km:1329,comment:""},
  {n:27,date:"Oct 14, 2024",airline:"American",fn:"AA1082",dep:"DFW",arr:"CLT",ac:"A321 EOW",acs:"A321",mfr:"Airbus",reg:"N118NN",h:1.95,km:1506,comment:"Surprise weekend in Waco"},
  {n:28,date:"Oct 14, 2024",airline:"American",fn:"AA5686",dep:"CLT",arr:"EWN",ac:"ERJ-145LR",acs:"E145",mfr:"Embraer",reg:"N931AE",h:0.58,km:356,comment:"Piedmont Airlines"},
  {n:29,date:"Oct 17, 2024",airline:"American",fn:"AA5778",dep:"EWN",arr:"CLT",ac:"ERJ-145LR",acs:"E145",mfr:"Embraer",reg:"N694PP",h:0.83,km:356,comment:"Piedmont Airlines"},
  {n:30,date:"Oct 17, 2024",airline:"American",fn:"AA5297",dep:"CLT",arr:"MSN",ac:"CRJ-900LR",acs:"CRJ-900",mfr:"Bombardier",reg:"N598NN",h:1.70,km:1506,comment:"American Eagle; PSA Airlines"},
  {n:31,date:"Oct 19, 2024",airline:"United",fn:"UA373",dep:"ORD",arr:"DEN",ac:"777-222",acs:"777",mfr:"Boeing",reg:"N779UA",h:2.03,km:1430,comment:"Going for Tim+Katie wedding"},
  {n:32,date:"Oct 20, 2024",airline:"United",fn:"UA377",dep:"DEN",arr:"ORD",ac:"737 MAX 9",acs:"737",mfr:"Boeing",reg:"N27511",h:1.88,km:1430,comment:"Coming Back from Wedding"},
  {n:33,date:"Oct 28, 2024",airline:"Delta",fn:"DL4972",dep:"MSN",arr:"LGA",ac:"CRJ-900LR",acs:"CRJ-900",mfr:"Bombardier",reg:"N147PQ",h:1.68,km:1306,comment:"Delta Connection; Endeavor Air"},
  {n:34,date:"Oct 31, 2024",airline:"Delta",fn:"DL999",dep:"LGA",arr:"DTW",ac:"A320-212",acs:"A320",mfr:"Airbus",reg:"N372NW",h:1.43,km:807,comment:""},
  {n:35,date:"Oct 31, 2024",airline:"Delta",fn:"DL3166",dep:"DTW",arr:"MSN",ac:"717-232",acs:"717",mfr:"Boeing",reg:"N932AT",h:0.92,km:502,comment:""},
  {n:36,date:"Nov 03, 2024",airline:"American",fn:"AA3657",dep:"MSN",arr:"DFW",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N212NN",h:2.65,km:1320,comment:"American Eagle; Envoy"},
  {n:37,date:"Nov 04, 2024",airline:"American",fn:"AA1340",dep:"DFW",arr:"FLL",ac:"A321-231",acs:"A321",mfr:"Airbus",reg:"N127AA",h:2.42,km:1800,comment:""},
  {n:38,date:"Nov 07, 2024",airline:"American",fn:"AA2087",dep:"FLL",arr:"CLT",ac:"A321-211",acs:"A321",mfr:"Airbus",reg:"N171US",h:1.80,km:1017,comment:""},
  {n:39,date:"Nov 07, 2024",airline:"American",fn:"AA1168",dep:"CLT",arr:"MSN",ac:"A319-132",acs:"A319",mfr:"Airbus",reg:"N820AW",h:1.72,km:1506,comment:""},
  {n:40,date:"Nov 25, 2024",airline:"American",fn:"AA2544",dep:"ORD",arr:"SFO",ac:"737-823",acs:"737",mfr:"Boeing",reg:"N317PG",h:4.65,km:2971,comment:""},
  {n:41,date:"Dec 01, 2024",airline:"American",fn:"AA2614",dep:"SFO",arr:"ORD",ac:"737-823",acs:"737",mfr:"Boeing",reg:"N904NN",h:3.68,km:2971,comment:""},
  {n:42,date:"Dec 20, 2024",airline:"United",fn:"UA2289",dep:"ORD",arr:"SFO",ac:"A321-271NX",acs:"A321",mfr:"Airbus",reg:"N24516",h:3.93,km:2971,comment:""},
  {n:43,date:"Dec 27, 2024",airline:"United",fn:"UA1896",dep:"SFO",arr:"ORD",ac:"A321-271NX",acs:"A321",mfr:"Airbus",reg:"N14518",h:3.63,km:2971,comment:""},
  {n:44,date:"Jan 13, 2025",airline:"United",fn:"UA4715",dep:"MSN",arr:"ORD",ac:"CRJ-550",acs:"CRJ-550",mfr:"Bombardier",reg:"N558GJ",h:0.55,km:175,comment:"EOW Week"},
  {n:45,date:"Jan 13, 2025",airline:"United",fn:"UA2184",dep:"ORD",arr:"SMF",ac:"737 MAX 9",acs:"737",mfr:"Boeing",reg:"N77579",h:4.00,km:2867,comment:""},
  {n:46,date:"Jan 16, 2025",airline:"United",fn:"UA1422",dep:"SMF",arr:"DEN",ac:"737 MAX 8",acs:"737",mfr:"Boeing",reg:"N27260",h:2.02,km:1463,comment:""},
  {n:47,date:"Jan 16, 2025",airline:"United",fn:"UA1483",dep:"DEN",arr:"MSN",ac:"737 MAX 9",acs:"737",mfr:"Boeing",reg:"N27586",h:1.68,km:1329,comment:""},
  {n:48,date:"Jan 24, 2025",airline:"American",fn:"AA2516",dep:"MSN",arr:"DFW",ac:"A319-112",acs:"A319",mfr:"Airbus",reg:"N725UW",h:1.97,km:1321,comment:"January 2025 Waco Trip"},
  {n:49,date:"Jan 27, 2025",airline:"American",fn:"AA876",dep:"DFW",arr:"MSN",ac:"A319-132",acs:"A319",mfr:"Airbus",reg:"N838AW",h:1.73,km:1321,comment:""},
  {n:50,date:"Jan 31, 2025",airline:"Delta",fn:"DL2599",dep:"MSN",arr:"ATL",ac:"717-231",acs:"717",mfr:"Boeing",reg:"N935AT",h:1.67,km:1138,comment:""},
  {n:51,date:"Jan 31, 2025",airline:"Delta",fn:"DL1001",dep:"ATL",arr:"JAX",ac:"757-251",acs:"757",mfr:"Boeing",reg:"N551NW",h:0.77,km:434,comment:""},
  {n:52,date:"Feb 03, 2025",airline:"United",fn:"UA3566",dep:"JAX",arr:"ORD",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N721YX",h:2.32,km:1391,comment:""},
  {n:53,date:"Feb 03, 2025",airline:"United",fn:"UA2184",dep:"ORD",arr:"SMF",ac:"737 MAX 9",acs:"737",mfr:"Boeing",reg:"N27568",h:4.37,km:2867,comment:""},
  {n:54,date:"Feb 06, 2025",airline:"American",fn:"AA2448",dep:"SMF",arr:"DFW",ac:"A321-231",acs:"A321",mfr:"Airbus",reg:"N563UW",h:2.58,km:2303,comment:""},
  {n:55,date:"Feb 06, 2025",airline:"American",fn:"AA876",dep:"DFW",arr:"MSN",ac:"A319-132",acs:"A319",mfr:"Airbus",reg:"N808AW",h:1.72,km:1321,comment:""},
  {n:56,date:"Feb 14, 2025",airline:"American",fn:"AA3308",dep:"MSN",arr:"DFW",ac:"A319-112",acs:"A319",mfr:"Airbus",reg:"N767UW",h:2.20,km:1321,comment:""},
  {n:57,date:"Feb 16, 2025",airline:"American",fn:"AA876",dep:"DFW",arr:"MSN",ac:"A321-231",acs:"A321",mfr:"Airbus",reg:"N158AN",h:1.78,km:1321,comment:""},
  {n:58,date:"Mar 03, 2025",airline:"United",fn:"UA364",dep:"MSN",arr:"DEN",ac:"737-824",acs:"737",mfr:"Boeing",reg:"N78509",h:2.02,km:1329,comment:""},
  {n:59,date:"Mar 03, 2025",airline:"United",fn:"UA1415",dep:"DEN",arr:"SMF",ac:"737-824",acs:"737",mfr:"Boeing",reg:"N73256",h:2.10,km:1463,comment:""},
  {n:60,date:"Mar 06, 2025",airline:"United",fn:"UA1422",dep:"SMF",arr:"DEN",ac:"737-924ER",acs:"737",mfr:"Boeing",reg:"N75425",h:1.92,km:1463,comment:""},
  {n:61,date:"Mar 09, 2025",airline:"United",fn:"UA1483",dep:"DEN",arr:"MSN",ac:"737-824",acs:"737",mfr:"Boeing",reg:"N73251",h:1.72,km:1329,comment:""},
  {n:62,date:"Mar 30, 2025",airline:"Delta",fn:"DL5645",dep:"MSN",arr:"DCA",ac:"E170SU",acs:"E170",mfr:"Embraer",reg:"N810MD",h:1.67,km:1138,comment:""},
  {n:63,date:"Apr 01, 2025",airline:"Delta",fn:"DL1454",dep:"DCA",arr:"DTW",ac:"A320-212",acs:"A320",mfr:"Airbus",reg:"N362NW",h:1.13,km:656,comment:""},
  {n:64,date:"Apr 01, 2025",airline:"Delta",fn:"DL1106",dep:"DTW",arr:"MSN",ac:"717-231",acs:"717",mfr:"Boeing",reg:"N915AT",h:0.97,km:502,comment:""},
  {n:65,date:"Apr 18, 2025",airline:"American",fn:"AA1826",dep:"MSN",arr:"DFW",ac:"A319-132",acs:"A319",mfr:"Airbus",reg:"N802AW",h:2.27,km:1321,comment:""},
  {n:66,date:"Apr 20, 2025",airline:"American",fn:"AA876",dep:"DFW",arr:"MSN",ac:"A319-112",acs:"A319",mfr:"Airbus",reg:"N709UW",h:1.70,km:1321,comment:""},
  {n:67,date:"May 10, 2025",airline:"American",fn:"AA2007",dep:"MSN",arr:"DFW",ac:"A319-112",acs:"A319",mfr:"Airbus",reg:"N704US",h:2.05,km:1321,comment:""},
  {n:68,date:"May 10, 2025",airline:"American",fn:"AA2585",dep:"DFW",arr:"SJC",ac:"737-823",acs:"737",mfr:"Boeing",reg:"N978NN",h:3.12,km:2315,comment:""},
  {n:69,date:"May 16, 2025",airline:"United",fn:"UA1671",dep:"SJC",arr:"DEN",ac:"A320-232",acs:"A320",mfr:"Airbus",reg:"N476UA",h:2.08,km:1526,comment:""},
  {n:70,date:"May 18, 2025",airline:"United",fn:"UA1483",dep:"DEN",arr:"MSN",ac:"737-924ER",acs:"737",mfr:"Boeing",reg:"N81449",h:2.15,km:1329,comment:""},
  {n:71,date:"May 30, 2025",airline:"United",fn:"UA4603",dep:"MSN",arr:"ORD",ac:"CRJ-550",acs:"CRJ-550",mfr:"Bombardier",reg:"N559GJ",h:0.53,km:175,comment:""},
  {n:72,date:"May 30, 2025",airline:"United",fn:"UA1182",dep:"ORD",arr:"SJC",ac:"A319-132",acs:"A319",mfr:"Airbus",reg:"N897UA",h:3.72,km:2944,comment:""},
  {n:73,date:"Jun 06, 2025",airline:"Delta",fn:"DL3902",dep:"SJC",arr:"LAX",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N255SY",h:0.88,km:496,comment:""},
  {n:74,date:"Jun 08, 2025",airline:"United",fn:"UA1912",dep:"LAX",arr:"DEN",ac:"757-324",acs:"757",mfr:"Boeing",reg:"N75858",h:2.28,km:1479,comment:""},
  {n:75,date:"Jun 08, 2025",airline:"United",fn:"UA1483",dep:"DEN",arr:"MSN",ac:"737-824",acs:"737",mfr:"Boeing",reg:"N79521",h:1.60,km:1329,comment:""},
  {n:76,date:"Jun 27, 2025",airline:"American",fn:"AA1826",dep:"MSN",arr:"DFW",ac:"A319-112",acs:"A319",mfr:"Airbus",reg:"N771XF",h:2.17,km:1321,comment:""},
  {n:77,date:"Jun 27, 2025",airline:"American",fn:"AA3349",dep:"DFW",arr:"ACT",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N236NN",h:0.33,km:144,comment:""},
  {n:78,date:"Jun 29, 2025",airline:"American",fn:"AA3428",dep:"ACT",arr:"DFW",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N741AK",h:0.67,km:144,comment:""},
  {n:79,date:"Jun 29, 2025",airline:"American",fn:"AA876",dep:"DFW",arr:"MSN",ac:"A319-132",acs:"A319",mfr:"Airbus",reg:"N805AW",h:1.82,km:1321,comment:""},
  {n:80,date:"Jul 18, 2025",airline:"United",fn:"UA2106",dep:"ORD",arr:"SFO",ac:"A321-271NX",acs:"A321",mfr:"Airbus",reg:"N14536",h:4.18,km:2792,comment:""},
  {n:81,date:"Jul 20, 2025",airline:"United",fn:"UA1470",dep:"SFO",arr:"ORD",ac:"777-222",acs:"777",mfr:"Boeing",reg:"N210UA",h:3.42,km:2792,comment:""},
  {n:82,date:"Aug 01, 2025",airline:"United",fn:"UA5993",dep:"MSN",arr:"DEN",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N131SY",h:2.40,km:1329,comment:""},
  {n:83,date:"Aug 01, 2025",airline:"United",fn:"UA2368",dep:"DEN",arr:"SNA",ac:"737 MAX 8",acs:"737",mfr:"Boeing",reg:"N27253",h:2.00,km:1361,comment:""},
  {n:84,date:"Aug 10, 2025",airline:"United",fn:"UA374",dep:"SJC",arr:"ORD",ac:"A320-232",acs:"A320",mfr:"Airbus",reg:"N490UA",h:4.80,km:2944,comment:""},
  {n:85,date:"Aug 10, 2025",airline:"United",fn:"UA2177",dep:"ORD",arr:"MSN",ac:"A319-131",acs:"A319",mfr:"Airbus",reg:"N854UA",h:0.43,km:175,comment:""},
  {n:86,date:"Sep 06, 2025",airline:"Delta",fn:"DL1264",dep:"ORD",arr:"ATL",ac:"A321-211",acs:"A321",mfr:"Airbus",reg:"N107DN",h:1.53,km:975,comment:""},
  {n:87,date:"Sep 06, 2025",airline:"Delta",fn:"DL2923",dep:"ATL",arr:"JAX",ac:"757-251",acs:"757",mfr:"Boeing",reg:"N544US",h:0.70,km:434,comment:""},
  {n:88,date:"Sep 07, 2025",airline:"American",fn:"AA2789",dep:"JAX",arr:"DFW",ac:"737-823",acs:"737",mfr:"Boeing",reg:"N815NN",h:2.17,km:1478,comment:""},
  {n:89,date:"Sep 07, 2025",airline:"American",fn:"AA1937",dep:"DFW",arr:"BZN",ac:"737-823",acs:"737",mfr:"Boeing",reg:"N876NN",h:2.63,km:1872,comment:""},
  {n:90,date:"Sep 13, 2025",airline:"American",fn:"AA817",dep:"BZN",arr:"DFW",ac:"737-823",acs:"737",mfr:"Boeing",reg:"N980NN",h:2.60,km:1872,comment:""},
  {n:91,date:"Sep 14, 2025",airline:"American",fn:"AA2346",dep:"DFW",arr:"ORD",ac:"737-823",acs:"737",mfr:"Boeing",reg:"N827NN",h:1.73,km:1290,comment:""},
  {n:92,date:"Sep 22, 2025",airline:"American",fn:"AA797",dep:"MSN",arr:"DFW",ac:"A320-214",acs:"A320",mfr:"Airbus",reg:"N124US",h:2.33,km:1321,comment:""},
  {n:93,date:"Sep 22, 2025",airline:"American",fn:"AA2078",dep:"DFW",arr:"SMF",ac:"737-823",acs:"737",mfr:"Boeing",reg:"N352PS",h:3.23,km:2303,comment:""},
  {n:94,date:"Sep 26, 2025",airline:"American",fn:"AA1544",dep:"SMF",arr:"DFW",ac:"A321-231",acs:"A321",mfr:"Airbus",reg:"N154AA",h:3.02,km:2303,comment:""},
  {n:95,date:"Sep 28, 2025",airline:"American",fn:"AA4081",dep:"ACT",arr:"DFW",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N323ED",h:0.53,km:144,comment:"First Class üòé"},
  {n:96,date:"Sep 28, 2025",airline:"American",fn:"AA876",dep:"DFW",arr:"MSN",ac:"A321-231",acs:"A321",mfr:"Airbus",reg:"N551UW",h:1.82,km:1321,comment:"First Class üòé"},
  {n:97,date:"Oct 03, 2025",airline:"United",fn:"UA5993",dep:"MSN",arr:"DEN",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N167SY",h:1.87,km:1329,comment:""},
  {n:98,date:"Oct 03, 2025",airline:"United",fn:"UA1229",dep:"DEN",arr:"SFO",ac:"737 MAX 9",acs:"737",mfr:"Boeing",reg:"N37521",h:2.42,km:1556,comment:""},
  {n:99,date:"Oct 09, 2025",airline:"American",fn:"AA1804",dep:"SFO",arr:"DFW",ac:"A321-231",acs:"A321",mfr:"Airbus",reg:"N147AA",h:2.80,km:2357,comment:""},
  {n:100,date:"Oct 09, 2025",airline:"American",fn:"AA1736",dep:"DFW",arr:"MSN",ac:"A320-214",acs:"A320",mfr:"Airbus",reg:"N124US",h:1.88,km:1321,comment:""},
  {n:101,date:"Oct 31, 2025",airline:"American",fn:"AA5647",dep:"MSN",arr:"DCA",ac:"CRJ-702ER",acs:"CRJ-700",mfr:"Bombardier",reg:"N534AE",h:1.55,km:1138,comment:"PSA Airlines; American Eagle"},
  {n:102,date:"Nov 07, 2025",airline:"United",fn:"UA1667",dep:"EWR",arr:"MSN",ac:"A319-132",acs:"A319",mfr:"Airbus",reg:"N872UA",h:2.12,km:1285,comment:""},
  {n:103,date:"Nov 22, 2025",airline:"United",fn:"UA2748",dep:"MSN",arr:"DEN",ac:"A320-232",acs:"A320",mfr:"Airbus",reg:"N443UA",h:1.92,km:1329,comment:""},
  {n:104,date:"Dec 01, 2025",airline:"United",fn:"UA1208",dep:"DEN",arr:"SMF",ac:"737-824",acs:"737",mfr:"Boeing",reg:"N17229",h:2.07,km:1463,comment:""},
  {n:105,date:"Dec 05, 2025",airline:"United",fn:"UA1278",dep:"SMF",arr:"ORD",ac:"737-824",acs:"737",mfr:"Boeing",reg:"N77536",h:3.63,km:2867,comment:""},
  {n:106,date:"Dec 05, 2025",airline:"United",fn:"UA1049",dep:"ORD",arr:"MSN",ac:"A319-131",acs:"A319",mfr:"Airbus",reg:"N834UA",h:0.52,km:175,comment:""},
  {n:107,date:"Dec 23, 2025",airline:"Emirates",fn:"EK236",dep:"ORD",arr:"DXB",ac:"777-300ER",acs:"777",mfr:"Boeing",reg:"A6-EQO",h:12.97,km:11655,comment:""},
  {n:108,date:"Dec 24, 2025",airline:"Emirates",fn:"EK542",dep:"DXB",arr:"MAA",ac:"777-31HER",acs:"777",mfr:"Boeing",reg:"A6-EPQ",h:3.30,km:2937,comment:""},
  {n:109,date:"Dec 25, 2025",airline:"IndiGo",fn:"6E7193",dep:"MAA",arr:"TCR",ac:"ATR 72-600",acs:"ATR 72",mfr:"ATR",reg:"VT-IYP",h:1.28,km:528,comment:"Baby land in Thoothukudiiiii"},
  {n:110,date:"Jan 03, 2026",airline:"IndiGo",fn:"6E7606",dep:"TCR",arr:"MAA",ac:"ATR 72-600",acs:"ATR 72",mfr:"ATR",reg:"VT-IYL",h:1.35,km:528,comment:""},
  {n:111,date:"Jan 04, 2026",airline:"Emirates",fn:"EK545",dep:"MAA",arr:"DXB",ac:"777-31HER",acs:"777",mfr:"Boeing",reg:"A6-EGS",h:3.67,km:2937,comment:""},
  {n:112,date:"Jan 05, 2026",airline:"Emirates",fn:"EK235",dep:"DXB",arr:"ORD",ac:"777-300ER",acs:"777",mfr:"Boeing",reg:"A6-EQP",h:14.17,km:11655,comment:""},
  {n:113,date:"Feb 13, 2026",airline:"Delta",fn:"DL2599",dep:"MSN",arr:"ATL",ac:"717-2BD",acs:"717",mfr:"Boeing",reg:"N946AT",h:1.48,km:1138,comment:""},
  {n:114,date:"Feb 13, 2026",airline:"Delta",fn:"DL1335",dep:"ATL",arr:"AUS",ac:"A320-211",acs:"A320",mfr:"Airbus",reg:"N325US",h:2.17,km:1308,comment:""},
  {n:115,date:"Feb 16, 2026",airline:"United",fn:"UA2447",dep:"AUS",arr:"DEN",ac:"737-824",acs:"737",mfr:"Boeing",reg:"N76528",h:1.92,km:1247,comment:""},
  {n:116,date:"Feb 16, 2026",airline:"United",fn:"UA4672",dep:"DEN",arr:"BFL",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N114SY",h:2.65,km:1359,comment:""},
  {n:117,date:"Feb 20, 2026",airline:"United",fn:"UA4764",dep:"FAT",arr:"DEN",ac:"E175LR",acs:"E175",mfr:"Embraer",reg:"N118SY",h:1.82,km:1358,comment:""},
  {n:118,date:"Feb 20, 2026",airline:"United",fn:"UA1894",dep:"DEN",arr:"MSN",ac:"737-924(ER)",acs:"737",mfr:"Boeing",reg:"N64809",h:1.78,km:1329,comment:""}
];

const AIRPORTS = {
  // ‚îÄ‚îÄ ALREADY IN YOUR LOG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  ACT:{lat:31.6113,lon:-97.2265,name:"Waco Regional"},
  ATL:{lat:33.6407,lon:-84.4277,name:"Hartsfield-Jackson Atlanta"},
  AUS:{lat:30.1975,lon:-97.6664,name:"Austin-Bergstrom Intl"},
  BFL:{lat:35.4336,lon:-119.0568,name:"Bakersfield Meadows Field"},
  BWI:{lat:39.1754,lon:-76.6683,name:"Baltimore/Washington Intl"},
  BZN:{lat:45.7772,lon:-111.1531,name:"Bozeman Yellowstone Intl"},
  CLT:{lat:35.2141,lon:-80.9431,name:"Charlotte Douglas Intl"},
  DCA:{lat:38.8521,lon:-77.0377,name:"Ronald Reagan Washington"},
  DEN:{lat:39.8561,lon:-104.6737,name:"Denver Intl"},
  DFW:{lat:32.8998,lon:-97.0403,name:"Dallas/Fort Worth Intl"},
  DOH:{lat:25.2731,lon:51.608,name:"Hamad Intl (Doha)"},
  DTW:{lat:42.2124,lon:-83.3534,name:"Detroit Metropolitan"},
  DXB:{lat:25.2528,lon:55.3644,name:"Dubai Intl"},
  EWN:{lat:35.073,lon:-77.0429,name:"Coastal Carolina Regional"},
  EWR:{lat:40.6895,lon:-74.1745,name:"Newark Liberty Intl"},
  FAT:{lat:36.7762,lon:-119.7181,name:"Fresno Yosemite Intl"},
  FLL:{lat:26.0726,lon:-80.1527,name:"Fort Lauderdale-Hollywood"},
  JAX:{lat:30.4941,lon:-81.6879,name:"Jacksonville Intl"},
  LAX:{lat:33.9425,lon:-118.4081,name:"Los Angeles Intl"},
  LGA:{lat:40.7769,lon:-73.874,name:"LaGuardia"},
  MAA:{lat:12.9941,lon:80.1709,name:"Chennai Intl"},
  MKE:{lat:42.9472,lon:-87.8966,name:"Milwaukee Mitchell Intl"},
  MRY:{lat:36.587,lon:-121.843,name:"Monterey Regional"},
  MSN:{lat:43.1399,lon:-89.3375,name:"Dane County Regional (Madison)"},
  ORD:{lat:41.9742,lon:-87.9073,name:"Chicago O'Hare Intl"},
  ORF:{lat:36.8976,lon:-76.0121,name:"Norfolk Intl"},
  SFO:{lat:37.6213,lon:-122.379,name:"San Francisco Intl"},
  SJC:{lat:37.3639,lon:-121.9289,name:"San Jose Mineta Intl"},
  SMF:{lat:38.6954,lon:-121.5911,name:"Sacramento Intl"},
  SNA:{lat:33.6757,lon:-117.8682,name:"John Wayne (Orange County)"},
  TCR:{lat:10.7654,lon:79.8419,name:"Tuticorin Airport"},
  // ‚îÄ‚îÄ MAJOR US HUBS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  ABQ:{lat:35.0402,lon:-106.6090,name:"Albuquerque Sunport"},
  ANC:{lat:61.1743,lon:-149.9963,name:"Ted Stevens Anchorage Intl"},
  BDL:{lat:41.9389,lon:-72.6832,name:"Bradley Intl"},
  BNA:{lat:36.1245,lon:-86.6782,name:"Nashville Intl"},
  BOS:{lat:42.3656,lon:-71.0096,name:"Boston Logan Intl"},
  BUF:{lat:42.9405,lon:-78.7322,name:"Buffalo Niagara Intl"},
  BUR:{lat:34.2007,lon:-118.3585,name:"Hollywood Burbank"},
  CHS:{lat:32.8986,lon:-80.0405,name:"Charleston Intl"},
  CLE:{lat:41.4117,lon:-81.8498,name:"Cleveland Hopkins Intl"},
  CLT:{lat:35.2141,lon:-80.9431,name:"Charlotte Douglas Intl"},
  CMH:{lat:39.9980,lon:-82.8919,name:"John Glenn Columbus Intl"},
  CVG:{lat:39.0488,lon:-84.6678,name:"Cincinnati/Northern Kentucky Intl"},
  DAL:{lat:32.8471,lon:-96.8517,name:"Dallas Love Field"},
  DAY:{lat:39.9024,lon:-84.2194,name:"Dayton Intl"},
  DEN:{lat:39.8561,lon:-104.6737,name:"Denver Intl"},
  DSM:{lat:41.5340,lon:-93.6631,name:"Des Moines Intl"},
  ELP:{lat:31.8072,lon:-106.3779,name:"El Paso Intl"},
  FNT:{lat:42.9654,lon:-83.7436,name:"Flint Bishop Intl"},
  GEG:{lat:47.6199,lon:-117.5339,name:"Spokane Intl"},
  GRR:{lat:42.8808,lon:-85.5228,name:"Gerald R. Ford Intl"},
  GSO:{lat:36.0978,lon:-79.9373,name:"Piedmont Triad Intl"},
  GSP:{lat:34.8957,lon:-82.2189,name:"Greenville-Spartanburg Intl"},
  HNL:{lat:21.3187,lon:-157.9225,name:"Daniel K. Inouye Intl (Honolulu)"},
  HOU:{lat:29.6454,lon:-95.2789,name:"Houston Hobby"},
  HPN:{lat:41.0670,lon:-73.7076,name:"Westchester County"},
  HRL:{lat:26.2285,lon:-97.6544,name:"Valley Intl (Harlingen)"},
  IAD:{lat:38.9531,lon:-77.4565,name:"Washington Dulles Intl"},
  IAH:{lat:29.9902,lon:-95.3368,name:"George Bush Intercontinental"},
  ICT:{lat:37.6499,lon:-97.4331,name:"Wichita Dwight D. Eisenhower Natl"},
  IND:{lat:39.7173,lon:-86.2944,name:"Indianapolis Intl"},
  ISP:{lat:40.7952,lon:-73.1002,name:"Long Island MacArthur"},
  JAN:{lat:32.3112,lon:-90.0759,name:"Jackson-Medgar Wiley Evers Intl"},
  JFK:{lat:40.6413,lon:-73.7781,name:"John F. Kennedy Intl"},
  JNU:{lat:58.3550,lon:-134.5763,name:"Juneau Intl"},
  KOA:{lat:19.7388,lon:-156.0456,name:"Ellison Onizuka Kona Intl"},
  LAS:{lat:36.0840,lon:-115.1537,name:"Harry Reid Intl (Las Vegas)"},
  LAX:{lat:33.9425,lon:-118.4081,name:"Los Angeles Intl"},
  LEX:{lat:38.0365,lon:-84.6059,name:"Blue Grass Airport (Lexington)"},
  LGB:{lat:33.8177,lon:-118.1516,name:"Long Beach Airport"},
  LIH:{lat:21.9760,lon:-159.3388,name:"Lihue Airport (Kauai)"},
  LIT:{lat:34.7294,lon:-92.2243,name:"Bill & Hillary Clinton Natl"},
  LNK:{lat:40.8510,lon:-96.7592,name:"Lincoln Airport"},
  LRD:{lat:27.5438,lon:-99.4615,name:"Laredo Intl"},
  LSE:{lat:43.8790,lon:-91.2567,name:"La Crosse Regional"},
  MAF:{lat:31.9425,lon:-102.2019,name:"Midland Intl Air & Space Port"},
  MCI:{lat:39.2976,lon:-94.7139,name:"Kansas City Intl"},
  MCO:{lat:28.4312,lon:-81.3081,name:"Orlando Intl"},
  MDW:{lat:41.7868,lon:-87.7522,name:"Chicago Midway Intl"},
  MEM:{lat:35.0424,lon:-89.9767,name:"Memphis Intl"},
  MHT:{lat:42.9326,lon:-71.4357,name:"Manchester-Boston Regional"},
  MIA:{lat:25.7959,lon:-80.2870,name:"Miami Intl"},
  MKE:{lat:42.9472,lon:-87.8966,name:"Milwaukee Mitchell Intl"},
  MLI:{lat:41.4485,lon:-90.5075,name:"Quad City Intl"},
  MOB:{lat:30.6913,lon:-88.2428,name:"Mobile Regional"},
  MSP:{lat:44.8848,lon:-93.2223,name:"Minneapolis-Saint Paul Intl"},
  MSY:{lat:29.9934,lon:-90.2580,name:"Louis Armstrong New Orleans Intl"},
  MTJ:{lat:38.5098,lon:-107.8938,name:"Montrose Regional"},
  MYR:{lat:33.6797,lon:-78.9283,name:"Myrtle Beach Intl"},
  OAK:{lat:37.7213,lon:-122.2208,name:"Oakland Intl"},
  OGG:{lat:20.8986,lon:-156.4305,name:"Kahului Airport (Maui)"},
  OKC:{lat:35.3931,lon:-97.6007,name:"Will Rogers World Airport"},
  OMA:{lat:41.3032,lon:-95.8941,name:"Eppley Airfield (Omaha)"},
  ONT:{lat:34.0560,lon:-117.6012,name:"Ontario Intl"},
  PBI:{lat:26.6832,lon:-80.0956,name:"Palm Beach Intl"},
  PDX:{lat:45.5898,lon:-122.5951,name:"Portland Intl"},
  PHL:{lat:39.8721,lon:-75.2411,name:"Philadelphia Intl"},
  PHX:{lat:33.4373,lon:-112.0078,name:"Phoenix Sky Harbor Intl"},
  PIT:{lat:40.4915,lon:-80.2329,name:"Pittsburgh Intl"},
  PNS:{lat:30.4734,lon:-87.1866,name:"Pensacola Intl"},
  PSP:{lat:33.8297,lon:-116.5067,name:"Palm Springs Intl"},
  PVD:{lat:41.7272,lon:-71.4282,name:"Providence T.F. Green Intl"},
  PWM:{lat:43.6462,lon:-70.3093,name:"Portland Intl Jetport (Maine)"},
  RDU:{lat:35.8801,lon:-78.7880,name:"Raleigh-Durham Intl"},
  RFD:{lat:42.1954,lon:-89.0972,name:"Chicago Rockford Intl"},
  RIC:{lat:37.5052,lon:-77.3197,name:"Richmond Intl"},
  RNO:{lat:39.4991,lon:-119.7681,name:"Reno-Tahoe Intl"},
  ROC:{lat:43.1189,lon:-77.6724,name:"Frederick Douglass Greater Rochester"},
  RSW:{lat:26.5362,lon:-81.7552,name:"Southwest Florida Intl"},
  SAF:{lat:35.6171,lon:-106.0882,name:"Santa Fe Regional"},
  SAN:{lat:32.7338,lon:-117.1933,name:"San Diego Intl"},
  SAT:{lat:29.5337,lon:-98.4698,name:"San Antonio Intl"},
  SAV:{lat:32.1276,lon:-81.2021,name:"Savannah/Hilton Head Intl"},
  SBN:{lat:41.7087,lon:-86.3173,name:"South Bend Intl"},
  SDF:{lat:38.1744,lon:-85.7360,name:"Louisville Muhammad Ali Intl"},
  SEA:{lat:47.4502,lon:-122.3088,name:"Seattle-Tacoma Intl"},
  SHV:{lat:32.4466,lon:-93.8256,name:"Shreveport Regional"},
  SJU:{lat:18.4394,lon:-66.0018,name:"Luis Munoz Marin Intl (San Juan)"},
  SLC:{lat:40.7884,lon:-111.9778,name:"Salt Lake City Intl"},
  SRQ:{lat:27.3954,lon:-82.5544,name:"Sarasota-Bradenton Intl"},
  STL:{lat:38.7487,lon:-90.3700,name:"St. Louis Lambert Intl"},
  SYR:{lat:43.1112,lon:-76.1063,name:"Syracuse Hancock Intl"},
  TLH:{lat:30.3965,lon:-84.3503,name:"Tallahassee Intl"},
  TPA:{lat:27.9755,lon:-82.5332,name:"Tampa Intl"},
  TUL:{lat:36.1984,lon:-95.8881,name:"Tulsa Intl"},
  TUS:{lat:32.1161,lon:-110.9410,name:"Tucson Intl"},
  TYS:{lat:35.8110,lon:-83.9940,name:"McGhee Tyson Airport (Knoxville)"},
  VPS:{lat:30.4832,lon:-86.5254,name:"Destin-Fort Walton Beach"},
  XNA:{lat:36.2819,lon:-94.3068,name:"Northwest Arkansas National"},
  // ‚îÄ‚îÄ REGIONAL US ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  ABE:{lat:40.6521,lon:-75.4408,name:"Lehigh Valley Intl"},
  ABI:{lat:32.4113,lon:-99.6819,name:"Abilene Regional"},
  AGS:{lat:33.3699,lon:-81.9645,name:"Augusta Regional"},
  ALB:{lat:42.7483,lon:-73.8017,name:"Albany Intl"},
  ALO:{lat:42.5571,lon:-92.4003,name:"Waterloo Regional"},
  AMA:{lat:35.2194,lon:-101.7059,name:"Rick Husband Amarillo Intl"},
  ASE:{lat:39.2232,lon:-106.8690,name:"Aspen/Pitkin County"},
  AVL:{lat:35.4362,lon:-82.5418,name:"Asheville Regional"},
  BHM:{lat:33.5629,lon:-86.7535,name:"Birmingham-Shuttlesworth Intl"},
  BIL:{lat:45.8077,lon:-108.5430,name:"Billings Logan Intl"},
  BIS:{lat:46.7727,lon:-100.7467,name:"Bismarck Airport"},
  BOI:{lat:43.5644,lon:-116.2228,name:"Boise Airport"},
  BTR:{lat:30.5332,lon:-91.1496,name:"Baton Rouge Metropolitan"},
  CAE:{lat:33.9389,lon:-81.1195,name:"Columbia Metropolitan"},
  CAK:{lat:40.9161,lon:-81.4422,name:"Akron-Canton Airport"},
  CID:{lat:41.8847,lon:-91.7108,name:"Eastern Iowa Airport (Cedar Rapids)"},
  COS:{lat:38.8059,lon:-104.7009,name:"Colorado Springs Airport"},
  CRP:{lat:27.7704,lon:-97.5012,name:"Corpus Christi Intl"},
  DAB:{lat:29.1799,lon:-81.0581,name:"Daytona Beach Intl"},
  DLH:{lat:46.8421,lon:-92.1936,name:"Duluth Intl"},
  EGE:{lat:39.6426,lon:-106.9177,name:"Eagle County Regional (Vail)"},
  EUG:{lat:44.1246,lon:-123.2119,name:"Eugene Airport"},
  EVV:{lat:38.0369,lon:-87.5324,name:"Evansville Regional"},
  EYW:{lat:24.5561,lon:-81.7596,name:"Key West Intl"},
  FAR:{lat:46.9207,lon:-96.8158,name:"Hector Intl (Fargo)"},
  FCA:{lat:48.3105,lon:-114.2560,name:"Glacier Park Intl (Kalispell)"},
  FSD:{lat:43.5820,lon:-96.7419,name:"Sioux Falls Regional"},
  FSM:{lat:35.3366,lon:-94.3674,name:"Fort Smith Regional"},
  FWA:{lat:40.9785,lon:-85.1951,name:"Fort Wayne Intl"},
  GCN:{lat:35.9524,lon:-112.1474,name:"Grand Canyon National Park"},
  GFK:{lat:47.9493,lon:-97.1761,name:"Grand Forks Intl"},
  GJT:{lat:39.1224,lon:-108.5267,name:"Grand Junction Regional"},
  GPT:{lat:30.4073,lon:-89.0701,name:"Gulfport-Biloxi Intl"},
  GRB:{lat:44.4851,lon:-88.1296,name:"Green Bay Austin Straubel Intl"},
  GTF:{lat:47.4820,lon:-111.3709,name:"Great Falls Intl"},
  HDN:{lat:40.4812,lon:-107.2218,name:"Yampa Valley Airport (Hayden)"},
  HGR:{lat:39.7079,lon:-77.7295,name:"Hagerstown Regional"},
  HIB:{lat:47.3866,lon:-92.8390,name:"Range Regional (Hibbing)"},
  HSV:{lat:34.6372,lon:-86.7751,name:"Huntsville Intl"},
  HYS:{lat:38.8422,lon:-99.2732,name:"Hays Regional"},
  ILM:{lat:34.2706,lon:-77.9026,name:"Wilmington Intl"},
  ITO:{lat:19.7214,lon:-155.0484,name:"Hilo Intl"},
  JAN:{lat:32.3112,lon:-90.0759,name:"Jackson-Medgar Wiley Evers Intl"},
  LAN:{lat:42.7787,lon:-84.5874,name:"Capital Region Intl (Lansing)"},
  LAW:{lat:34.5677,lon:-98.4166,name:"Lawton-Fort Sill Regional"},
  LBB:{lat:33.6636,lon:-101.8228,name:"Lubbock Preston Smith Intl"},
  LCH:{lat:30.1261,lon:-93.2233,name:"Lake Charles Regional"},
  LFT:{lat:30.2053,lon:-91.9876,name:"Lafayette Regional"},
  LNK:{lat:40.8510,lon:-96.7592,name:"Lincoln Airport"},
  LRD:{lat:27.5438,lon:-99.4615,name:"Laredo Intl"},
  LSE:{lat:43.8790,lon:-91.2567,name:"La Crosse Regional"},
  MAF:{lat:31.9425,lon:-102.2019,name:"Midland Intl"},
  MBS:{lat:43.5329,lon:-84.0800,name:"MBS Intl (Saginaw)"},
  MCN:{lat:32.6928,lon:-83.6492,name:"Middle Georgia Regional (Macon)"},
  MDT:{lat:40.1935,lon:-76.7634,name:"Harrisburg Intl"},
  MGM:{lat:32.3006,lon:-86.3940,name:"Montgomery Regional"},
  MLB:{lat:28.1028,lon:-80.6453,name:"Melbourne Orlando Intl"},
  MLU:{lat:32.5109,lon:-92.0377,name:"Monroe Regional"},
  MOT:{lat:48.2594,lon:-101.2800,name:"Minot Intl"},
  MSO:{lat:46.9163,lon:-114.0906,name:"Missoula Montana Airport"},
  OAJ:{lat:34.8292,lon:-77.6121,name:"Albert J. Ellis (Jacksonville NC)"},
  OGG:{lat:20.8986,lon:-156.4305,name:"Kahului Airport"},
  ORH:{lat:42.2673,lon:-71.8757,name:"Worcester Regional"},
  PAH:{lat:37.0608,lon:-88.7739,name:"Barkley Regional (Paducah)"},
  PFN:{lat:30.2121,lon:-85.6828,name:"Panama City Northwest Florida Beaches"},
  PGV:{lat:35.6350,lon:-77.3853,name:"Pitt-Greenville Airport"},
  PIB:{lat:31.4671,lon:-89.3371,name:"Hattiesburg-Laurel Regional"},
  PIH:{lat:42.9098,lon:-112.5960,name:"Pocatello Regional"},
  PLN:{lat:45.5710,lon:-84.7967,name:"Pellston Regional (Petoskey)"},
  PNS:{lat:30.4734,lon:-87.1866,name:"Pensacola Intl"},
  PSC:{lat:46.2647,lon:-119.1190,name:"Tri-Cities Airport (Pasco)"},
  RAP:{lat:44.0453,lon:-103.0574,name:"Rapid City Regional"},
  ROA:{lat:37.3255,lon:-79.9754,name:"Roanoke-Blacksburg Regional"},
  ROW:{lat:33.3016,lon:-104.5306,name:"Roswell Air Center"},
  SBP:{lat:35.2368,lon:-120.6423,name:"San Luis Obispo County Regional"},
  SCE:{lat:40.8493,lon:-77.8488,name:"University Park Airport (State College)"},
  SGF:{lat:37.2457,lon:-93.3886,name:"Springfield-Branson National"},
  SHV:{lat:32.4466,lon:-93.8256,name:"Shreveport Regional"},
  SIT:{lat:57.0471,lon:-135.3616,name:"Sitka Rocky Gutierrez"},
  SLC:{lat:40.7884,lon:-111.9778,name:"Salt Lake City Intl"},
  SPI:{lat:39.8441,lon:-89.6779,name:"Abraham Lincoln Capital (Springfield IL)"},
  SPS:{lat:33.9888,lon:-98.4919,name:"Wichita Falls Regional"},
  SUX:{lat:42.4026,lon:-96.3844,name:"Sioux Gateway (Sioux City)"},
  SWF:{lat:41.5041,lon:-74.1048,name:"New York Stewart Intl"},
  TRI:{lat:36.4752,lon:-82.4074,name:"Tri-Cities Regional (Bristol/Johnson City)"},
  TTN:{lat:40.2767,lon:-74.8135,name:"Trenton Mercer Airport"},
  TUP:{lat:34.2681,lon:-88.7699,name:"Tupelo Regional"},
  TWF:{lat:42.4818,lon:-114.4877,name:"Magic Valley Regional (Twin Falls)"},
  TXK:{lat:33.4538,lon:-93.9910,name:"Texarkana Regional"},
  TYR:{lat:32.3541,lon:-95.4024,name:"Tyler Pounds Regional"},
  VLD:{lat:30.7825,lon:-83.2767,name:"Valdosta Regional"},
  VPS:{lat:30.4832,lon:-86.5254,name:"Destin-Fort Walton Beach"},
  WRG:{lat:56.4843,lon:-132.3698,name:"Wrangell Airport"},
  YKM:{lat:46.5682,lon:-120.5441,name:"Yakima Air Terminal"},
  // ‚îÄ‚îÄ CANADA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  YEG:{lat:53.3097,lon:-113.5797,name:"Edmonton Intl"},
  YHZ:{lat:44.8808,lon:-63.5086,name:"Halifax Stanfield Intl"},
  YOW:{lat:45.3225,lon:-75.6692,name:"Ottawa Macdonald-Cartier Intl"},
  YQB:{lat:46.7911,lon:-71.3933,name:"Quebec City Jean Lesage Intl"},
  YUL:{lat:45.4706,lon:-73.7408,name:"Montreal-Trudeau Intl"},
  YVR:{lat:49.1967,lon:-123.1815,name:"Vancouver Intl"},
  YWG:{lat:49.9100,lon:-97.2398,name:"Winnipeg James Armstrong Richardson Intl"},
  YYC:{lat:51.1315,lon:-114.0106,name:"Calgary Intl"},
  YYZ:{lat:43.6777,lon:-79.6248,name:"Toronto Pearson Intl"},
  // ‚îÄ‚îÄ MEXICO & CARIBBEAN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  BOG:{lat:4.7016,lon:-74.1469,name:"El Dorado Intl (Bogota)"},
  CUN:{lat:21.0365,lon:-86.8771,name:"Cancun Intl"},
  GDL:{lat:20.5218,lon:-103.3111,name:"Don Miguel Hidalgo Intl (Guadalajara)"},
  GUA:{lat:14.5833,lon:-90.5275,name:"La Aurora Intl (Guatemala City)"},
  MEX:{lat:19.4363,lon:-99.0721,name:"Mexico City Intl"},
  MID:{lat:20.9370,lon:-89.6577,name:"Manuel Crescencio Rejon Intl (Merida)"},
  MZT:{lat:23.1614,lon:-106.2661,name:"General Rafael Buelna Intl (Mazatlan)"},
  NAS:{lat:25.0390,lon:-77.4662,name:"Lynden Pindling Intl (Nassau)"},
  PTY:{lat:9.0714,lon:-79.3835,name:"Tocumen Intl (Panama City)"},
  PVR:{lat:20.6801,lon:-105.2544,name:"Licenciado Gustavo Diaz Ordaz Intl (Puerto Vallarta)"},
  SJO:{lat:9.9939,lon:-84.2088,name:"Juan Santamaria Intl (San Jose CR)"},
  SJU:{lat:18.4394,lon:-66.0018,name:"Luis Munoz Marin Intl (San Juan)"},
  SXM:{lat:18.0410,lon:-63.1089,name:"Princess Juliana Intl (St Maarten)"},
  // ‚îÄ‚îÄ EUROPE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  AMS:{lat:52.3105,lon:4.7683,name:"Amsterdam Schiphol"},
  BCN:{lat:41.2974,lon:2.0833,name:"Barcelona El Prat"},
  CDG:{lat:49.0097,lon:2.5479,name:"Paris Charles de Gaulle"},
  DUB:{lat:53.4213,lon:-6.2701,name:"Dublin Airport"},
  FCO:{lat:41.8003,lon:12.2389,name:"Rome Fiumicino"},
  FRA:{lat:50.0379,lon:8.5622,name:"Frankfurt Airport"},
  GVA:{lat:46.2380,lon:6.1089,name:"Geneva Airport"},
  HAM:{lat:53.6304,lon:9.9882,name:"Hamburg Airport"},
  HEL:{lat:60.3172,lon:24.9633,name:"Helsinki Vantaa"},
  IST:{lat:41.2753,lon:28.7519,name:"Istanbul Airport"},
  LGW:{lat:51.1537,lon:-0.1821,name:"London Gatwick"},
  LHR:{lat:51.4775,lon:-0.4614,name:"London Heathrow"},
  LIS:{lat:38.7813,lon:-9.1359,name:"Lisbon Humberto Delgado"},
  MAD:{lat:40.4936,lon:-3.5668,name:"Madrid Barajas"},
  MAN:{lat:53.3537,lon:-2.2750,name:"Manchester Airport"},
  MUC:{lat:48.3538,lon:11.7861,name:"Munich Airport"},
  ORY:{lat:48.7233,lon:2.3794,name:"Paris Orly"},
  OSL:{lat:60.1976,lon:11.1004,name:"Oslo Gardermoen"},
  PRG:{lat:50.1008,lon:14.2600,name:"Prague Vaclav Havel"},
  STN:{lat:51.8860,lon:0.2389,name:"London Stansted"},
  VIE:{lat:48.1103,lon:16.5697,name:"Vienna Intl"},
  ZRH:{lat:47.4647,lon:8.5492,name:"Zurich Airport"},
  // ‚îÄ‚îÄ MIDDLE EAST & AFRICA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  ABU:{lat:24.4330,lon:54.6511,name:"Abu Dhabi Intl"},
  ADD:{lat:8.9779,lon:38.7993,name:"Addis Ababa Bole Intl"},
  AMM:{lat:31.7226,lon:35.9932,name:"Queen Alia Intl (Amman)"},
  BAH:{lat:26.2708,lon:50.6336,name:"Bahrain Intl"},
  BEY:{lat:33.8209,lon:35.4883,name:"Beirut Rafic Hariri Intl"},
  CAI:{lat:30.1219,lon:31.4056,name:"Cairo Intl"},
  CMN:{lat:33.3675,lon:-7.5897,name:"Mohammed V Intl (Casablanca)"},
  CPT:{lat:-33.9715,lon:18.6021,name:"Cape Town Intl"},
  JNB:{lat:-26.1392,lon:28.2460,name:"OR Tambo Intl (Johannesburg)"},
  KWI:{lat:29.2267,lon:47.9689,name:"Kuwait Intl"},
  MCT:{lat:23.5933,lon:58.2844,name:"Muscat Intl"},
  NBO:{lat:-1.3192,lon:36.9275,name:"Jomo Kenyatta Intl (Nairobi)"},
  RUH:{lat:24.9578,lon:46.6989,name:"King Khalid Intl (Riyadh)"},
  // ‚îÄ‚îÄ ASIA & PACIFIC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  BKK:{lat:13.6811,lon:100.7475,name:"Suvarnabhumi (Bangkok)"},
  BOM:{lat:19.0896,lon:72.8656,name:"Chhatrapati Shivaji Maharaj Intl (Mumbai)"},
  CAN:{lat:23.3924,lon:113.2988,name:"Guangzhou Baiyun Intl"},
  CGK:{lat:-6.1256,lon:106.6559,name:"Soekarno-Hatta Intl (Jakarta)"},
  DEL:{lat:28.5562,lon:77.1000,name:"Indira Gandhi Intl (Delhi)"},
  HKG:{lat:22.3080,lon:113.9185,name:"Hong Kong Intl"},
  ICN:{lat:37.4602,lon:126.4407,name:"Incheon Intl (Seoul)"},
  KIX:{lat:34.4347,lon:135.2440,name:"Kansai Intl (Osaka)"},
  KUL:{lat:2.7456,lon:101.7099,name:"Kuala Lumpur Intl"},
  MEL:{lat:-37.6690,lon:144.8410,name:"Melbourne Airport"},
  MNL:{lat:14.5086,lon:121.0194,name:"Ninoy Aquino Intl (Manila)"},
  NRT:{lat:35.7720,lon:140.3929,name:"Tokyo Narita Intl"},
  HND:{lat:35.5494,lon:139.7798,name:"Tokyo Haneda"},
  PEK:{lat:40.0799,lon:116.6031,name:"Beijing Capital Intl"},
  PKX:{lat:39.5098,lon:116.4105,name:"Beijing Daxing Intl"},
  PVG:{lat:31.1443,lon:121.8083,name:"Shanghai Pudong Intl"},
  SGN:{lat:10.8188,lon:106.6520,name:"Tan Son Nhat Intl (Ho Chi Minh City)"},
  SIN:{lat:1.3644,lon:103.9915,name:"Singapore Changi"},
  SYD:{lat:-33.9399,lon:151.1753,name:"Sydney Kingsford Smith"},
  TPE:{lat:25.0777,lon:121.2328,name:"Taiwan Taoyuan Intl"},
  // ‚îÄ‚îÄ INDIA (expanded) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  BLR:{lat:13.1986,lon:77.7066,name:"Kempegowda Intl (Bangalore)"},
  CCU:{lat:22.6547,lon:88.4467,name:"Netaji Subhas Chandra Bose Intl (Kolkata)"},
  COK:{lat:10.1520,lon:76.4019,name:"Cochin Intl"},
  HYD:{lat:17.2313,lon:78.4298,name:"Rajiv Gandhi Intl (Hyderabad)"},
  IDR:{lat:22.7218,lon:75.8011,name:"Devi Ahilya Bai Holkar (Indore)"},
  IXC:{lat:30.6735,lon:76.7885,name:"Chandigarh Intl"},
  JAI:{lat:26.8242,lon:75.8122,name:"Jaipur Intl"},
  NAG:{lat:21.0922,lon:79.0472,name:"Dr. Babasaheb Ambedkar Intl (Nagpur)"},
  PAT:{lat:25.5913,lon:85.0880,name:"Jay Prakash Narayan Intl (Patna)"},
  TRV:{lat:8.4812,lon:76.9201,name:"Trivandrum Intl"},
  VTZ:{lat:17.7212,lon:83.2245,name:"Visakhapatnam Airport"},
  // ‚îÄ‚îÄ INDIA REGIONAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  AGX:{lat:10.8237,lon:72.1763,name:"Agatti Aerodrome (Lakshadweep)"},
  AMD:{lat:23.0771,lon:72.6347,name:"Sardar Vallabhbhai Patel Intl (Ahmedabad)"},
  ATQ:{lat:31.7096,lon:74.7974,name:"Sri Guru Ram Dass Jee Intl (Amritsar)"},
  BBI:{lat:20.2441,lon:85.8178,name:"Biju Patnaik Intl (Bhubaneswar)"},
  BDQ:{lat:22.3362,lon:73.2263,name:"Vadodara Airport"},
  BHO:{lat:23.2875,lon:77.3375,name:"Raja Bhoj Airport (Bhopal)"},
  BHU:{lat:21.7522,lon:72.1852,name:"Bhavnagar Airport"},
  BOM:{lat:19.0896,lon:72.8656,name:"Chhatrapati Shivaji Maharaj Intl (Mumbai)"},
  CCJ:{lat:11.1368,lon:75.9553,name:"Calicut Intl (Kozhikode)"},
  CDP:{lat:13.6332,lon:79.5430,name:"Kadapa Airport"},
  CNN:{lat:10.0039,lon:76.8092,name:"Kannur Intl"},
  CJB:{lat:11.0300,lon:77.0434,name:"Coimbatore Intl"},
  DEL:{lat:28.5562,lon:77.1000,name:"Indira Gandhi Intl (Delhi)"},
  DED:{lat:30.1897,lon:78.1800,name:"Jolly Grant Airport (Dehradun)"},
  DIB:{lat:27.4839,lon:95.0169,name:"Dibrugarh Airport"},
  DMU:{lat:25.8840,lon:93.7710,name:"Dimapur Airport"},
  GAU:{lat:26.1061,lon:91.5859,name:"Lokpriya Gopinath Bordoloi Intl (Guwahati)"},
  GAY:{lat:24.7443,lon:84.9512,name:"Gaya Airport"},
  GBD:{lat:22.0393,lon:82.0159,name:"Raja Bhoj Airport (Raipur)"},
  GOI:{lat:15.3808,lon:73.8314,name:"Goa Intl (Dabolim)"},
  GOP:{lat:26.7397,lon:83.4497,name:"Gorakhpur Airport"},
  HBX:{lat:15.3617,lon:75.0649,name:"Hubli Airport"},
  IMP:{lat:24.7600,lon:93.8967,name:"Imphal Airport"},
  IXA:{lat:23.8868,lon:91.2404,name:"Maharaja Bir Bikram Airport (Agartala)"},
  IXB:{lat:26.6812,lon:88.3286,name:"Bagdogra Airport (Siliguri)"},
  IXD:{lat:25.4401,lon:81.7339,name:"Allahabad Airport"},
  IXE:{lat:12.9613,lon:74.8900,name:"Mangalore Intl"},
  IXG:{lat:15.8593,lon:74.6183,name:"Belgaum Airport"},
  IXH:{lat:24.3062,lon:91.8699,name:"Kailashahar Airport"},
  IXI:{lat:27.8350,lon:94.9628,name:"Lilabari Airport (Lakhimpur)"},
  IXJ:{lat:32.6891,lon:74.8374,name:"Jammu Airport"},
  IXK:{lat:23.0671,lon:68.1004,name:"Kandla Airport"},
  IXL:{lat:34.1359,lon:77.5465,name:"Kushok Bakula Rimpochee (Leh)"},
  IXM:{lat:9.8345,lon:78.0934,name:"Madurai Airport"},
  IXP:{lat:33.2681,lon:75.5358,name:"Pathankot Airport"},
  IXR:{lat:23.3143,lon:85.3217,name:"Birsa Munda Airport (Ranchi)"},
  IXS:{lat:24.9129,lon:92.9786,name:"Silchar Airport"},
  IXT:{lat:26.1059,lon:92.7847,name:"Tezpur Airport"},
  IXU:{lat:19.8672,lon:75.3981,name:"Aurangabad Airport"},
  IXW:{lat:22.8132,lon:86.1688,name:"Jamshedpur Airport"},
  IXY:{lat:23.1127,lon:70.1003,name:"Kandla Airport"},
  IXZ:{lat:11.6412,lon:92.7296,name:"Veer Savarkar Intl (Port Blair)"},
  JDH:{lat:26.2511,lon:73.0489,name:"Jodhpur Airport"},
  JGA:{lat:22.4655,lon:70.0146,name:"Jamnagar Airport"},
  JLR:{lat:23.1778,lon:80.0523,name:"Jabalpur Airport"},
  JSA:{lat:26.8887,lon:70.8650,name:"Jaisalmer Airport"},
  KLH:{lat:16.6647,lon:74.2893,name:"Kolhapur Airport"},
  KNU:{lat:26.4044,lon:80.3649,name:"Kanpur Airport"},
  LKO:{lat:26.7606,lon:80.8893,name:"Chaudhary Charan Singh Intl (Lucknow)"},
  MYQ:{lat:12.2306,lon:76.6496,name:"Mysore Airport"},
  NDC:{lat:17.6333,lon:77.3167,name:"Nanded Airport"},
  NMB:{lat:20.9444,lon:73.0131,name:"Daman Airport"},
  OMC:{lat:17.7953,lon:83.5257,name:"Nabarangapur Airport"},
  PNQ:{lat:18.5822,lon:73.9197,name:"Pune Airport"},
  PYB:{lat:17.4610,lon:78.5594,name:"Begumpet Airport (Hyderabad old)"},
  RAJ:{lat:22.3092,lon:70.7796,name:"Rajkot Airport"},
  RDP:{lat:25.9804,lon:87.4299,name:"Kazi Nazrul Islam Airport (Durgapur)"},
  RPR:{lat:21.1804,lon:81.7388,name:"Swami Vivekananda Airport (Raipur)"},
  RRK:{lat:22.2567,lon:84.8147,name:"Rourkela Airport"},
  SHL:{lat:25.7036,lon:91.9787,name:"Umroi Airport (Shillong)"},
  SLV:{lat:31.0828,lon:77.0674,name:"Shimla Airport"},
  STV:{lat:21.1141,lon:72.7418,name:"Surat Airport"},
  TIR:{lat:13.6325,lon:79.5433,name:"Tirupati Airport"},
  TJV:{lat:10.7654,lon:79.1018,name:"Thanjavur Airport"},
  TRZ:{lat:10.7654,lon:78.7097,name:"Tiruchirappalli Intl"},
  UDR:{lat:24.6177,lon:73.8961,name:"Maharana Pratap Airport (Udaipur)"},
  VGA:{lat:16.5304,lon:80.7967,name:"Vijayawada Airport"},
  VNS:{lat:25.4524,lon:82.8593,name:"Lal Bahadur Shastri Intl (Varanasi)"},
};


var flightData=[],filtered=[],sortCol='n',sortDir=1,activeAirline='',activeAircraft='',activeMfr='',activeAirport='',activeDateFrom='',activeDateTo='',pendingDeleteId=null,mapLayers=[];

// ‚îÄ‚îÄ DATE HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function parseFlightDate(str){
  var d=new Date(str);
  // Handle "Mar 15, 2026" format
  if(isNaN(d.getTime())) d=new Date(Date.parse(str));
  return d;
}
function setDateChip(type,el){
  document.querySelectorAll('.date-chip').forEach(function(c){c.classList.remove('active');});
  var now=new Date(),from='',to='';
  if(type==='month'){
    from=new Date(now.getFullYear(),now.getMonth(),1).toISOString().slice(0,10);
    to=new Date(now.getFullYear(),now.getMonth()+1,0).toISOString().slice(0,10);
    el.classList.add('active');
  } else if(type==='3month'){
    var d3=new Date(now);d3.setMonth(d3.getMonth()-3);
    from=d3.toISOString().slice(0,10);
    to=now.toISOString().slice(0,10);
    el.classList.add('active');
  } else if(type==='year'){
    from=new Date(now.getFullYear(),0,1).toISOString().slice(0,10);
    to=new Date(now.getFullYear(),11,31).toISOString().slice(0,10);
    el.classList.add('active');
  }
  // 'all' just clears
  document.getElementById('dateFrom').value=from;
  document.getElementById('dateTo').value=to;
  activeDateFrom=from;activeDateTo=to;
  applyFilters();
}

// ‚îÄ‚îÄ DARK / LIGHT MODE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleTheme(){
  document.body.classList.toggle('light-mode');
  document.getElementById('themeIcon').textContent=document.body.classList.contains('light-mode')?'üåô':'‚òÄÔ∏è';
}

// ‚îÄ‚îÄ TAB SWITCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(tab){
  document.querySelectorAll('.tab-btn').forEach(function(b){b.classList.remove('active');});
  document.querySelectorAll('.tab-panel').forEach(function(p){p.classList.remove('active');});
  document.getElementById('tab'+tab.charAt(0).toUpperCase()+tab.slice(1)).classList.add('active');
  document.getElementById('panel'+tab.charAt(0).toUpperCase()+tab.slice(1)).classList.add('active');
  if(tab==='trends') renderTrends(filtered);
}

// ‚îÄ‚îÄ CLEAR ALL FILTERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateClearBtn(){
  var hasFilters=activeAirport||activeAirline||activeAircraft||activeDateFrom||activeDateTo||
    document.getElementById('searchInput').value||
    document.getElementById('airlineFilter').value||
    document.getElementById('mfrFilter').value;
  var btn=document.getElementById('clearAllBtn');
  btn.style.opacity=hasFilters?'1':'0';
  btn.style.pointerEvents=hasFilters?'auto':'none';
}

function clearAllFilters(){
  activeAirport='';activeAirline='';activeAircraft='';activeMfr='';activeDateFrom='';activeDateTo='';
  document.getElementById('dateFrom').value='';
  document.getElementById('dateTo').value='';
  document.querySelectorAll('.date-chip').forEach(function(c){c.classList.remove('active');});
  document.getElementById('searchInput').value='';
  document.getElementById('airlineFilter').value='';
  document.getElementById('mfrFilter').value='';
  document.getElementById('airportBanner').style.display='none';
  renderMap();
  applyFilters();
}
function setAirportFilter(code){
  activeAirport=code;
  var banner=document.getElementById('airportBanner');
  if(code){
    document.getElementById('bannerCode').textContent=code+' ‚Äî '+(AIRPORTS[code]?AIRPORTS[code].name:code);
    banner.style.display='flex';
  } else {
    banner.style.display='none';
  }
  applyFilters();
}
function clearAirportFilter(){
  setAirportFilter('');
  // also clear search box if it was set by map click
  if(document.getElementById('searchInput').value===activeAirport){
    document.getElementById('searchInput').value='';
  }
  applyFilters();
}

// ‚îÄ‚îÄ SYNC STATUS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setSyncStatus(state,text){
  var el=document.getElementById('syncStatus');
  el.className='sync-status '+state;
  document.getElementById('syncText').textContent=text;
}

// ‚îÄ‚îÄ LOADING SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setLoading(pct,msg){
  document.getElementById('loadingFill').style.width=pct+'%';
  document.getElementById('loadingMsg').textContent=msg;
}
function hideLoading(){
  var el=document.getElementById('loadingScreen');
  el.classList.add('hidden');
  setTimeout(function(){el.style.display='none';},600);
}

// ‚îÄ‚îÄ MAP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var map=L.map('map',{center:[30,-20],zoom:2,worldCopyJump:true});
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap',maxZoom:18}).addTo(map);

function geodesicArc(a,b,c,d){var e=80,R=Math.PI/180,D=180/Math.PI,p1=a*R,l1=b*R,p2=c*R,l2=d*R,dist=2*Math.asin(Math.sqrt(Math.pow(Math.sin((p2-p1)/2),2)+Math.cos(p1)*Math.cos(p2)*Math.pow(Math.sin((l2-l1)/2),2)));if(dist===0)return[[a,b],[c,d]];var pts=[];for(var i=0;i<=e;i++){var f=i/e,A=Math.sin((1-f)*dist)/Math.sin(dist),B=Math.sin(f*dist)/Math.sin(dist),x=A*Math.cos(p1)*Math.cos(l1)+B*Math.cos(p2)*Math.cos(l2),y=A*Math.cos(p1)*Math.sin(l1)+B*Math.cos(p2)*Math.sin(l2),z=A*Math.sin(p1)+B*Math.sin(p2);pts.push([Math.atan2(z,Math.sqrt(x*x+y*y))*D,Math.atan2(y,x)*D]);}return pts;}

function renderMap(){
  mapLayers.forEach(function(l){map.removeLayer(l);});mapLayers=[];
  var rm={};
  flightData.forEach(function(f){var k=[f.dep,f.arr].sort().join('-');if(!rm[k])rm[k]={dep:f.dep,arr:f.arr,count:0};rm[k].count++;});
  Object.values(rm).forEach(function(r){var A=AIRPORTS[r.dep],B=AIRPORTS[r.arr];if(!A||!B)return;var l=L.polyline(geodesicArc(A.lat,A.lon,B.lat,B.lon),{color:'rgba(0,212,255,0.35)',weight:Math.min(1+r.count*0.3,3),opacity:1,smoothFactor:1,interactive:false}).addTo(map);mapLayers.push(l);});
  var cnt={};flightData.forEach(function(f){cnt[f.dep]=(cnt[f.dep]||0)+1;cnt[f.arr]=(cnt[f.arr]||0)+1;});
  var used=new Set(flightData.map(function(f){return f.dep;}).concat(flightData.map(function(f){return f.arr;})));
  used.forEach(function(code){
    var ap=AIRPORTS[code];if(!ap)return;
    var c=cnt[code]||0,r=Math.max(5,Math.min(12,5+c*0.5));
    var deps=flightData.filter(function(f){return f.dep===code;}).length,arrs=flightData.filter(function(f){return f.arr===code;}).length;
    var isActive=activeAirport===code;
    var mk=L.circleMarker([ap.lat,ap.lon],{
      radius:isActive?r+3:r,
      fillColor:isActive?'#ffffff':'#00d4ff',
      fillOpacity:0.9,
      color:isActive?'#00d4ff':'#003344',
      weight:isActive?2.5:1.5
    }).addTo(map);
    mk.bindPopup("<div class='ap-name'>"+ap.name+"</div><div class='ap-code'>"+code+"</div><div class='ap-stats'><b>"+(deps+arrs)+"</b> flights &middot; <b>"+deps+"</b> dep &middot; <b>"+arrs+"</b> arr</div>",{className:'airport-popup',maxWidth:240});
    mk.on('click',function(e){
      L.DomEvent.stopPropagation(e);
      if(activeAirport===code){
        setAirportFilter('');
      } else {
        setAirportFilter(code);
      }
      renderMap();
    });
    mapLayers.push(mk);
  });
}

// Clicking the map background clears airport filter
map.on('click',function(){
  if(activeAirport){setAirportFilter('');renderMap();}
});

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fmtH(h){var hh=Math.floor(h),mm=Math.round((h-hh)*60);return hh+'h '+String(mm).padStart(2,'0')+'m';}
function showToast(msg,err){var t=document.getElementById('toast');t.textContent=msg;t.classList.toggle('error',!!err);t.classList.add('show');clearTimeout(window._tt);window._tt=setTimeout(function(){t.classList.remove('show');},3500);}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAll(){
  filtered=[...flightData];
  applyFilters();
  renderMap();
  setTimeout(function(){map.invalidateSize();},100);
}

function renderHeaderStats(data){
  var h=data.reduce(function(a,f){return a+f.h;},0),km=data.reduce(function(a,f){return a+f.km;},0);
  var aps=new Set(data.map(function(f){return f.dep;}).concat(data.map(function(f){return f.arr;}))).size;
  var als=new Set(data.map(function(f){return f.airline;})).size;
  document.getElementById('headerStats').innerHTML='<div class="hstat"><div class="hstat-val">'+data.length+'</div><div class="hstat-lbl">Flights</div></div><div class="hstat"><div class="hstat-val">'+Math.round(h)+'h</div><div class="hstat-lbl">In the Air</div></div><div class="hstat"><div class="hstat-val">'+Math.round(km*0.621371/1000)+'k</div><div class="hstat-lbl">Miles</div></div><div class="hstat"><div class="hstat-val">'+aps+'</div><div class="hstat-lbl">Airports</div></div><div class="hstat"><div class="hstat-val">'+als+'</div><div class="hstat-lbl">Airlines</div></div>';
}

function renderStats(data){
  if(!data.length){document.getElementById('statsGrid').innerHTML='';return;}
  var h=data.reduce(function(a,f){return a+f.h;},0),km=data.reduce(function(a,f){return a+f.km;},0);
  var longest=data.reduce(function(a,f){return f.km>a.km?f:a;},{km:0,dep:'',arr:'',h:0});
  var shortest=data.reduce(function(a,f){return f.km<a.km?f:a;},{km:Infinity,dep:'',arr:'',h:0});
  var acT=new Set(data.map(function(f){return f.acs;})).size;
  var mfrCounts={};data.forEach(function(f){if(f.mfr)mfrCounts[f.mfr]=(mfrCounts[f.mfr]||0)+1;});
  var topMfr=Object.entries(mfrCounts).sort(function(a,b){return b[1]-a[1];})[0]||['Unknown',0];
  var topMfrPct=Math.round(topMfr[1]/data.length*100);
  var hasMfr=Object.keys(mfrCounts).length>0;
  var hasAcType=acT>0&&data.some(function(f){return f.acs&&f.acs.trim();});
  var hasDistance=data.some(function(f){return f.km>0;});
  document.getElementById('statsGrid').innerHTML=
    '<div class="stat-card"><div class="stat-label">Total Flights</div><div class="stat-value cyan">'+data.length+'</div><div class="stat-sub">logged flights</div></div>'+
    (hasDistance?'<div class="stat-card"><div class="stat-label">Total Distance</div><div class="stat-value cyan">'+Math.round(km*0.621371).toLocaleString()+'</div><div class="stat-sub">miles flown</div></div>':'')+
    (h>0?'<div class="stat-card"><div class="stat-label">Total Time</div><div class="stat-value amber">'+h.toFixed(1)+'h</div><div class="stat-sub">'+(h/24).toFixed(1)+' days in the air</div></div>':'')+
    '<div class="stat-card"><div class="stat-label">Unique Airports</div><div class="stat-value green">'+new Set(data.map(function(f){return f.dep;}).concat(data.map(function(f){return f.arr;}))).size+'</div><div class="stat-sub">cities visited</div></div>'+
    (hasAcType?'<div class="stat-card"><div class="stat-label">Aircraft Types</div><div class="stat-value">'+acT+'</div><div class="stat-sub">unique variants</div></div>':'')+
    (hasDistance&&longest.km>0?'<div class="stat-card"><div class="stat-label">Longest Flight</div><div class="stat-value" style="font-size:1.4rem">'+longest.dep+' &rarr; '+longest.arr+'</div><div class="stat-sub">'+Math.round(longest.km*0.621371).toLocaleString()+' mi &middot; '+fmtH(longest.h)+'</div></div>':'')+
    (hasDistance&&shortest.km<Infinity?'<div class="stat-card"><div class="stat-label">Shortest Flight</div><div class="stat-value" style="font-size:1.4rem">'+shortest.dep+' &rarr; '+shortest.arr+'</div><div class="stat-sub">'+Math.round(shortest.km*0.621371)+' mi &middot; '+fmtH(shortest.h)+'</div></div>':'')+
    (hasMfr?'<div class="stat-card"><div class="stat-label">Top Manufacturer</div><div class="stat-value">'+topMfrPct+'%</div><div class="stat-sub">'+topMfr[0]+'</div></div>':'')+
    (hasDistance&&data.length>0?'<div class="stat-card"><div class="stat-label">Avg Flight</div><div class="stat-value">'+Math.round(km*0.621371/data.length).toLocaleString()+'</div><div class="stat-sub">miles per flight</div></div>':'');
}

function renderAirlineBars(data){
  var counts={};data.forEach(function(f){if(f.airline&&f.airline!=='Unknown')counts[f.airline]=(counts[f.airline]||0)+1;});
  var sorted=Object.entries(counts).sort(function(a,b){return b[1]-a[1];});
  var section=document.getElementById('airlineBars').closest('.airline-section');
  if(!sorted.length){if(section)section.style.display='none';return;}
  if(section)section.style.display='';
  var max=sorted[0]?sorted[0][1]:1;
  document.getElementById('airlineBars').innerHTML=sorted.map(function(e){var al=e[0],cnt=e[1];return '<div class="airline-bar-item'+(activeAirline===al?' active':'')+'" data-airline="'+al+'"><div class="airline-name">'+al+'</div><div class="airline-track"><div class="airline-fill al-'+al+'" style="width:'+(cnt/max*100).toFixed(1)+'%"></div></div><div class="airline-count">'+cnt+' flights</div></div>';}).join('');
  document.querySelectorAll('.airline-bar-item').forEach(function(el){el.addEventListener('click',function(){var al=this.dataset.airline;if(activeAirline===al){activeAirline='';document.getElementById('airlineFilter').value='';}else{activeAirline=al;document.getElementById('airlineFilter').value=al;}applyFilters();});});
}

function renderAircraftBars(data){
  var counts={};data.forEach(function(f){if(f.acs&&f.acs.trim())counts[f.acs]=(counts[f.acs]||0)+1;});
  var sorted=Object.entries(counts).sort(function(a,b){return b[1]-a[1];});
  var section=document.getElementById('aircraftBars').closest('.airline-section');
  if(!sorted.length){if(section)section.style.display='none';return;}
  if(section)section.style.display='';
  var max=sorted[0]?sorted[0][1]:1;
  var colors=['#00d4ff','#f59e0b','#10b981','#a78bfa','#f87171','#60a5fa','#34d399','#fb923c','#c084fc','#e879f9'];
  document.getElementById('aircraftBars').innerHTML=sorted.map(function(e,i){var ac=e[0],cnt=e[1];var col=colors[i%colors.length];return '<div class="airline-bar-item'+(activeAircraft===ac?' active':'')+'" data-aircraft="'+ac+'"><div class="airline-name" style="font-size:0.85rem">'+ac+'</div><div class="airline-track"><div class="airline-fill" style="width:'+(cnt/max*100).toFixed(1)+'%;background:'+col+'"></div></div><div class="airline-count">'+cnt+' flights</div></div>';}).join('');
  document.querySelectorAll('[data-aircraft]').forEach(function(el){el.addEventListener('click',function(){var ac=this.dataset.aircraft;if(activeAircraft===ac){activeAircraft='';}else{activeAircraft=ac;}applyFilters();});});
}

function renderMfrBars(data){
  var counts={};data.forEach(function(f){if(f.mfr&&f.mfr.trim()&&f.mfr!=='Unknown')counts[f.mfr]=(counts[f.mfr]||0)+1;});
  var sorted=Object.entries(counts).sort(function(a,b){return b[1]-a[1];});
  var section=document.getElementById('mfrBars').closest('.airline-section');
  if(!sorted.length){if(section)section.style.display='none';return;}
  if(section)section.style.display='';
  var max=sorted[0]?sorted[0][1]:1;
  var mfrColors={Boeing:'#1a7abf',Airbus:'#0050a0',Embraer:'#00875a',Bombardier:'#c85000',ATR:'#7c3aed'};
  document.getElementById('mfrBars').innerHTML=sorted.map(function(e,i){var mfr=e[0],cnt=e[1];var col=mfrColors[mfr]||'#4b5563';return '<div class="airline-bar-item'+(activeMfr===mfr?' active':'')+'" data-mfr="'+mfr+'"><div class="airline-name" style="font-size:0.85rem">'+mfr+'</div><div class="airline-track"><div class="airline-fill" style="width:'+(cnt/max*100).toFixed(1)+'%;background:'+col+'"></div></div><div class="airline-count">'+cnt+' flights</div></div>';}).join('');
  document.querySelectorAll('[data-mfr]').forEach(function(el){el.addEventListener('click',function(){var mfr=this.dataset.mfr;if(activeMfr===mfr){activeMfr='';document.getElementById('mfrFilter').value='';}else{activeMfr=mfr;document.getElementById('mfrFilter').value=mfr;}applyFilters();});});
}

function renderTable(data){
  document.getElementById('countShown').textContent=data.length;
  document.getElementById('countTotal').textContent=flightData.length;
  var body=document.getElementById('flightBody'),noR=document.getElementById('noResults');
  if(!data.length){body.innerHTML='';noR.style.display='block';return;}
  noR.style.display='none';
  body.innerHTML=data.map(function(f,i){return '<tr><td class="td-num">'+f.n+'</td><td class="td-date">'+f.date+'</td><td><div class="route-cell"><strong>'+f.dep+'</strong><span class="route-arrow">&rarr;</span><strong>'+f.arr+'</strong></div></td><td><span class="airline-badge badge-'+f.airline+'">'+f.airline+'</span></td><td class="fn-cell col-fn">'+f.fn+'</td><td class="ac-cell">'+f.ac+'</td><td class="ac-cell col-mfr" style="font-size:0.78rem">'+f.mfr+'</td><td class="km-cell">'+Math.round(f.km*0.621371).toLocaleString()+' mi</td><td class="h-cell">'+fmtH(f.h)+'</td><td class="comment-cell">'+(f.comment||'')+'</td>'+(guestMode?'':'<td><button class="btn-del" data-id="'+f.id+'" data-n="'+f.n+'">&times;</button></td>')+'</tr>';}).join('');
  document.querySelectorAll('.btn-del').forEach(function(btn){btn.addEventListener('click',function(e){e.stopPropagation();openConfirm(this.dataset.id,this.dataset.n);});});
}

function sortAndRender(){
  filtered.sort(function(a,b){var av=a[sortCol],bv=b[sortCol];if(typeof av==='string')return av.localeCompare(bv)*sortDir;return(av-bv)*sortDir;});
  renderTable(filtered);
}

document.querySelectorAll('th[data-col]').forEach(function(th){th.addEventListener('click',function(){var col=this.dataset.col;if(sortCol===col)sortDir*=-1;else{sortCol=col;sortDir=1;}document.querySelectorAll('th').forEach(function(t){t.classList.remove('sort-asc','sort-desc');});this.classList.add(sortDir===1?'sort-asc':'sort-desc');sortAndRender();});});

function applyFilters(){
  var q=document.getElementById('searchInput').value.toLowerCase().trim();
  var al=document.getElementById('airlineFilter').value;
  var mfr=document.getElementById('mfrFilter').value;
  var fromVal=document.getElementById('dateFrom').value;
  var toVal=document.getElementById('dateTo').value;
  filtered=flightData.filter(function(f){
    var mq=!q||[f.dep,f.arr,f.airline,f.fn,f.ac,f.acs,f.mfr,f.reg,f.date,f.comment].some(function(v){return String(v).toLowerCase().includes(q);});
    var apq=!activeAirport||(f.dep===activeAirport||f.arr===activeAirport);
    var fd=parseFlightDate(f.date);
    var dq=(!fromVal||fd>=new Date(fromVal))&&(!toVal||fd<=new Date(toVal+'T23:59:59'));
    return mq&&apq&&dq&&(!al||f.airline===al)&&(!mfr||f.mfr===mfr)&&(!activeAirline||f.airline===activeAirline)&&(!activeAircraft||f.acs===activeAircraft)&&(!activeMfr||f.mfr===activeMfr);
  });
  sortAndRender();renderStats(filtered);renderAirlineBars(filtered);renderAircraftBars(filtered);renderMfrBars(filtered);renderHeaderStats(filtered);updateClearBtn();
  if(document.getElementById('panelTrends').classList.contains('active')) renderTrends(filtered);
}

document.getElementById('searchInput').addEventListener('input',applyFilters);
document.getElementById('airlineFilter').addEventListener('change',function(){activeAirline=this.value;applyFilters();});
document.getElementById('mfrFilter').addEventListener('change',function(){activeMfr=this.value;applyFilters();});
document.getElementById('dateFrom').addEventListener('change',function(){activeDateFrom=this.value;document.querySelectorAll('.date-chip').forEach(function(c){c.classList.remove('active');});applyFilters();});
document.getElementById('dateTo').addEventListener('change',function(){activeDateTo=this.value;document.querySelectorAll('.date-chip').forEach(function(c){c.classList.remove('active');});applyFilters();});

// ‚îÄ‚îÄ HELP BANNER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleHelp(){
  var content=document.getElementById('helpContent');
  var chevron=document.getElementById('helpChevron');
  var open=content.style.display==='none';
  content.style.display=open?'block':'none';
  chevron.style.transform=open?'rotate(180deg)':'rotate(0deg)';
}

// ‚îÄ‚îÄ DISTANCE UNIT TOGGLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var distUnit={f:'mi',sf:'mi'};
function toggleDistUnit(prefix){
  var isKm=distUnit[prefix]==='mi';
  distUnit[prefix]=isKm?'km':'mi';
  var lbl=distUnit[prefix].toUpperCase();
  document.getElementById(prefix+'-dist-lbl').textContent=lbl;
  var btn=document.getElementById(prefix+'-dist-toggle');
  btn.textContent=lbl;
  btn.style.background=isKm?'rgba(0,212,255,0.15)':'var(--muted)';
  btn.style.borderColor=isKm?'var(--cyan)':'var(--border)';
  btn.style.color=isKm?'var(--cyan)':'var(--text-dim)';
  document.getElementById(prefix+'-km').placeholder=isKm?'e.g. 1320':'e.g. 821';
}
function getDistanceMiles(prefix){
  var val=parseFloat(document.getElementById(prefix+'-km').value)||0;
  if(!val) return 0;
  return distUnit[prefix]==='km'?Math.round(val*0.621371):Math.round(val);
}
const WORKER_URL='https://bold-brook-0abc.jacob-c-edwin.workers.dev';

function formatDateForAPI(dateStr){
  // Convert date input value (YYYY-MM-DD) to YYYY-MM-DD for API
  return dateStr;
}

function formatDateForDisplay(dateStr){
  // Convert YYYY-MM-DD to "Mar 15, 2026"
  var d=new Date(dateStr+'T12:00:00');
  return d.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
}

function calcDistanceFromAirports(dep,arr){
  var A=AIRPORTS[dep],B=AIRPORTS[arr];
  if(!A||!B) return '';
  var R=3958.8,dLat=(B.lat-A.lat)*Math.PI/180,dLon=(B.lon-A.lon)*Math.PI/180;
  var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(A.lat*Math.PI/180)*Math.cos(B.lat*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);
  return Math.round(2*R*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));
}

function fillFormFromAPI(data, prefix){
  // data = AviationStack flight object
  var dep=(data.departure&&data.departure.iata)||'';
  var arr=(data.arrival&&data.arrival.iata)||'';
  var airline=(data.airline&&data.airline.name)||'';
  var fn=(data.flight&&data.flight.iata)||'';
  var ac=(data.aircraft&&data.aircraft.iata)||'';
  var reg=(data.aircraft&&data.aircraft.registration)||'';

  // Calculate duration from scheduled times
  var hrs=0,mins=0;
  if(data.departure&&data.arrival&&data.departure.scheduled&&data.arrival.scheduled){
    var depT=new Date(data.departure.scheduled),arrT=new Date(data.arrival.scheduled);
    var diffMs=arrT-depT;
    if(diffMs>0){hrs=Math.floor(diffMs/3600000);mins=Math.round((diffMs%3600000)/60000);}
  }

  // Calculate distance from airports
  var distMi=dep&&arr?calcDistanceFromAirports(dep,arr):'';

  // Fill fields
  document.getElementById(prefix+'dep').value=dep.toUpperCase();
  document.getElementById(prefix+'arr').value=arr.toUpperCase();
  document.getElementById(prefix+'fn').value=fn||document.getElementById(prefix==='f-'?'f-fn-lookup':'sf-fn-lookup').value.toUpperCase();
  if(hrs>0||mins>0){document.getElementById(prefix+'h-hrs').value=hrs;document.getElementById(prefix+'h-min').value=mins;}
  if(distMi) document.getElementById(prefix+'km').value=distMi;
  if(ac) document.getElementById(prefix+'ac').value=ac;
  if(reg) document.getElementById(prefix+'reg').value=reg.toUpperCase();

  // Set airline dropdown
  var alSelect=document.getElementById(prefix+'airline');
  var alOpts=Array.from(alSelect.options).map(function(o){return o.value.toLowerCase();});
  var matchedAl=Array.from(alSelect.options).find(function(o){return airline.toLowerCase().includes(o.value.toLowerCase())&&o.value&&o.value!=='__other';});
  if(matchedAl){alSelect.value=matchedAl.value;}
  else if(airline){
    alSelect.value='__other';
    var otherWrapId=prefix==='f-'?'airlineOtherWrap':'sAirlineOtherWrap';
    var otherInputId=prefix==='f-'?'f-airline-other':'sf-airline-other';
    document.getElementById(otherWrapId).style.display='flex';
    document.getElementById(otherInputId).value=airline;
  }
}

async function lookupFlight(fnInput, dateInput, prefix, errorId, successBannerId, onSuccess){
  var fn=document.getElementById(fnInput).value.trim().toUpperCase();
  var date=document.getElementById(dateInput).value;
  if(!fn||!date){document.getElementById(errorId).textContent='Please enter a flight number and date';return;}

  var btn=document.getElementById(prefix==='f-'?'modalLookupBtn':'sheetLookupBtn');
  btn.textContent='LOOKING UP...';btn.disabled=true;
  document.getElementById(errorId).textContent='';

  try{
    var url=WORKER_URL+'?flight='+encodeURIComponent(fn)+'&date='+encodeURIComponent(date);
    var resp=await fetch(url);
    var data=await resp.json();

    if(data.data&&data.data.length>0){
      var flight=data.data[0];
      // Pre-fill date
      document.getElementById(prefix+'date').value=formatDateForDisplay(date);
      fillFormFromAPI(flight,prefix);
      document.getElementById(successBannerId).style.display='block';
      onSuccess();
    } else {
      // No data found ‚Äî go to manual with just date/fn pre-filled
      document.getElementById(prefix+'date').value=formatDateForDisplay(date);
      document.getElementById(prefix+'fn').value=fn;
      document.getElementById(errorId).textContent='';
      showToast('Flight not found ‚Äî fill in manually',false);
      onSuccess();
    }
  } catch(err){
    document.getElementById(errorId).textContent='Lookup failed ‚Äî check connection';
  } finally{
    btn.textContent='LOOK UP FLIGHT';btn.disabled=false;
  }
}

// ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openModal(){
  document.getElementById('modalOverlay').classList.add('open');
  document.getElementById('modalScreen1').style.display='block';
  document.getElementById('modalScreen2').style.display='none';
  document.getElementById('modalFooter').style.display='none';
  document.getElementById('lookupSuccessBanner').style.display='none';
  document.getElementById('lookupError').textContent='';
  document.getElementById('f-fn-lookup').focus();
}
function closeModal(){
  document.getElementById('modalOverlay').classList.remove('open');
  // Clear all fields
  ['f-date','f-fn','f-dep','f-arr','f-ac','f-acs','f-reg','f-h-hrs','f-h-min','f-km','f-comment','f-airline-other','f-mfr-other','f-fn-lookup'].forEach(function(id){var el=document.getElementById(id);if(el)el.value='';});
  document.getElementById('f-airline').value='';document.getElementById('f-mfr').value='';
  document.getElementById('airlineOtherWrap').style.display='none';document.getElementById('mfrOtherWrap').style.display='none';
  distUnit['f']='mi';
  document.getElementById('f-dist-lbl').textContent='MI';
  document.getElementById('f-dist-toggle').textContent='MI';
  document.getElementById('f-dist-toggle').style.background='var(--muted)';
  document.getElementById('f-dist-toggle').style.borderColor='var(--border)';
  document.getElementById('f-dist-toggle').style.color='var(--text-dim)';
  document.querySelectorAll('.field input.err,.field select.err').forEach(function(el){el.classList.remove('err');});
}
  document.getElementById('modalScreen1').style.display='none';
  document.getElementById('modalScreen2').style.display='block';
  document.getElementById('modalFooter').style.display='flex';
}

document.getElementById('modalLookupBtn').addEventListener('click',function(){
  lookupFlight('f-fn-lookup','f-date-lookup','f-','lookupError','lookupSuccessBanner',showModalScreen2);
});
document.getElementById('modalManualBtn').addEventListener('click',function(){
  var fn=document.getElementById('f-fn-lookup').value.trim().toUpperCase();
  var date=document.getElementById('f-date-lookup').value;
  if(fn) document.getElementById('f-fn').value=fn;
  if(date) document.getElementById('f-date').value=formatDateForDisplay(date);
  showModalScreen2();
});
document.getElementById('modalBackBtn').addEventListener('click',function(){
  document.getElementById('modalScreen1').style.display='block';
  document.getElementById('modalScreen2').style.display='none';
  document.getElementById('modalFooter').style.display='none';
});
document.getElementById('modalCloseBtn').addEventListener('click',closeModal);
document.getElementById('modalCancelBtn').addEventListener('click',closeModal);
document.getElementById('modalOverlay').addEventListener('click',function(e){if(e.target===this)closeModal();});
document.getElementById('f-airline').addEventListener('change',function(){document.getElementById('airlineOtherWrap').style.display=this.value==='__other'?'flex':'none';});
document.getElementById('f-mfr').addEventListener('change',function(){document.getElementById('mfrOtherWrap').style.display=this.value==='__other'?'flex':'none';});
['f-dep','f-arr','f-reg','f-fn-lookup'].forEach(function(id){document.getElementById(id).addEventListener('input',function(){this.value=this.value.toUpperCase();});});
document.getElementById('f-fn-lookup').addEventListener('keydown',function(e){if(e.key==='Enter')document.getElementById('modalLookupBtn').click();});
function openSheet(){
  document.getElementById('sheetOverlay').classList.add('open');
  document.getElementById('bottomSheet').classList.add('open');
  document.getElementById('sheetScreen1').style.display='block';
  document.getElementById('sheetScreen2').style.display='none';
  document.getElementById('sheetBackBtn').style.display='none';
  document.getElementById('sheetSubmitBtn').style.display='none';
  document.getElementById('sLookupSuccessBanner').style.display='none';
  document.getElementById('sLookupError').textContent='';
  setTimeout(function(){document.getElementById('sf-fn-lookup').focus();},350);
}
function closeSheet(){
  document.getElementById('sheetOverlay').classList.remove('open');
  document.getElementById('bottomSheet').classList.remove('open');
  ['sf-date','sf-fn','sf-dep','sf-arr','sf-ac','sf-acs','sf-reg','sf-h-hrs','sf-h-min','sf-km','sf-comment','sf-airline-other','sf-mfr-other','sf-fn-lookup'].forEach(function(id){var el=document.getElementById(id);if(el)el.value='';});
  document.getElementById('sf-airline').value='';document.getElementById('sf-mfr').value='';
  document.getElementById('sAirlineOtherWrap').style.display='none';document.getElementById('sMfrOtherWrap').style.display='none';
  distUnit['sf']='mi';
  document.getElementById('sf-dist-lbl').textContent='MI';
  document.getElementById('sf-dist-toggle').textContent='MI';
  document.getElementById('sf-dist-toggle').style.background='var(--muted)';
  document.getElementById('sf-dist-toggle').style.borderColor='var(--border)';
  document.getElementById('sf-dist-toggle').style.color='var(--text-dim)';
}
function showSheetScreen2(){
  document.getElementById('sheetScreen1').style.display='none';
  document.getElementById('sheetScreen2').style.display='block';
  document.getElementById('sheetBackBtn').style.display='inline-flex';
  document.getElementById('sheetSubmitBtn').style.display='inline-flex';
}

// Wire add button to open correct UI based on screen size
document.getElementById('addFlightBtn').addEventListener('click',function(){
  if(window.innerWidth<=640){openSheet();}else{openModal();}
});

document.getElementById('sheetLookupBtn').addEventListener('click',function(){
  lookupFlight('sf-fn-lookup','sf-date-lookup','sf-','sLookupError','sLookupSuccessBanner',showSheetScreen2);
});
document.getElementById('sheetManualBtn').addEventListener('click',function(){
  var fn=document.getElementById('sf-fn-lookup').value.trim().toUpperCase();
  var date=document.getElementById('sf-date-lookup').value;
  if(fn) document.getElementById('sf-fn').value=fn;
  if(date) document.getElementById('sf-date').value=formatDateForDisplay(date);
  showSheetScreen2();
});
document.getElementById('sheetBackBtn').addEventListener('click',function(){
  document.getElementById('sheetScreen1').style.display='block';
  document.getElementById('sheetScreen2').style.display='none';
  document.getElementById('sheetBackBtn').style.display='none';
  document.getElementById('sheetSubmitBtn').style.display='none';
});
document.getElementById('sheetOverlay').addEventListener('click',closeSheet);
document.getElementById('sheetCloseBtn').addEventListener('click',closeSheet);
document.getElementById('sheetCancelBtn').addEventListener('click',closeSheet);
document.getElementById('sf-airline').addEventListener('change',function(){document.getElementById('sAirlineOtherWrap').style.display=this.value==='__other'?'flex':'none';});
document.getElementById('sf-mfr').addEventListener('change',function(){document.getElementById('sMfrOtherWrap').style.display=this.value==='__other'?'flex':'none';});
['sf-dep','sf-arr','sf-reg','sf-fn-lookup'].forEach(function(id){document.getElementById(id).addEventListener('input',function(){this.value=this.value.toUpperCase();});});
document.getElementById('sf-fn-lookup').addEventListener('keydown',function(e){if(e.key==='Enter')document.getElementById('sheetLookupBtn').click();});

document.getElementById('sheetSubmitBtn').addEventListener('click',function(){
  var ok=true;
  ['sf-date','sf-fn'].forEach(function(id){var el=document.getElementById(id);el.classList.remove('err');if(!el.value.trim()){el.classList.add('err');ok=false;}});
  if(!ok){showToast('Please fill in date and flight number',true);return;}
  var hrsEl=document.getElementById('sf-h-hrs'),minEl=document.getElementById('sf-h-min');
  var hrs=parseInt(hrsEl.value)||0,mins=parseInt(minEl.value)||0;
  var h=Math.round((hrs+(mins/60))*1000)/1000;
  var km_mi=getDistanceMiles('sf');
  var km=km_mi?Math.round(km_mi/0.621371):0;
  var alEl=document.getElementById('sf-airline');
  var alV=alEl.value==='__other'?document.getElementById('sf-airline-other').value.trim():(alEl.value||'Unknown');
  var mfrS=document.getElementById('sf-mfr').value;
  var mfrV=mfrS==='__other'?document.getElementById('sf-mfr-other').value.trim()||'Other':(mfrS||'');
  var nextN=flightData.length?Math.max.apply(null,flightData.map(function(f){return f.n;}))+1:1;
  var newFlight={n:nextN,date:document.getElementById('sf-date').value.trim(),airline:alV,fn:document.getElementById('sf-fn').value.trim(),dep:document.getElementById('sf-dep').value.trim().toUpperCase(),arr:document.getElementById('sf-arr').value.trim().toUpperCase(),ac:document.getElementById('sf-ac').value.trim(),acs:document.getElementById('sf-acs').value.trim(),mfr:mfrV,reg:document.getElementById('sf-reg').value.trim().toUpperCase(),h:h,km:km,comment:document.getElementById('sf-comment').value.trim(),user_id:currentUser?currentUser.id:null};
  setSyncStatus('syncing','SAVING...');
  sb.from('flights').insert([newFlight]).select().then(function(res){
    if(res.error){showToast('Save failed: '+res.error.message,true);setSyncStatus('error','ERROR');return;}
    flightData.push(res.data[0]);
    ['sf-date','sf-fn','sf-dep','sf-arr','sf-ac','sf-acs','sf-reg','sf-h-hrs','sf-h-min','sf-km','sf-comment','sf-airline-other','sf-mfr-other'].forEach(function(id){document.getElementById(id).value='';});
    document.getElementById('sf-airline').value='';document.getElementById('sf-mfr').value='';
    document.getElementById('sAirlineOtherWrap').style.display='none';document.getElementById('sMfrOtherWrap').style.display='none';
    closeSheet();renderAll();setSyncStatus('connected','SYNCED');showToast('Flight added!');
  });
});
document.addEventListener('keydown',function(e){if(e.key==='Escape'){closeModal();closeConfirm();closeSheet();}});

document.getElementById('modalSubmitBtn').addEventListener('click',function(){
  var ok=true;
  ['f-date','f-fn'].forEach(function(id){var el=document.getElementById(id);el.classList.remove('err');if(!el.value.trim()){el.classList.add('err');ok=false;}});
  if(!ok){showToast('Please fill in date and flight number',true);return;}
  var hrsEl=document.getElementById('f-h-hrs'),minEl=document.getElementById('f-h-min');
  var hrs=parseInt(hrsEl.value)||0,mins=parseInt(minEl.value)||0;
  var h=Math.round((hrs+(mins/60))*1000)/1000;
  var km_mi=getDistanceMiles('f');
  var km=km_mi?Math.round(km_mi/0.621371):0;
  var alEl=document.getElementById('f-airline');
  var alV=alEl.value==='__other'?document.getElementById('f-airline-other').value.trim():(alEl.value||'Unknown');
  var mfrS=document.getElementById('f-mfr').value;
  var mfrV=mfrS==='__other'?document.getElementById('f-mfr-other').value.trim()||'Other':(mfrS||'');
  var nextN=flightData.length?Math.max.apply(null,flightData.map(function(f){return f.n;}))+1:1;
  var newFlight={n:nextN,date:document.getElementById('f-date').value.trim(),airline:alV,fn:document.getElementById('f-fn').value.trim(),dep:document.getElementById('f-dep').value.trim().toUpperCase(),arr:document.getElementById('f-arr').value.trim().toUpperCase(),ac:document.getElementById('f-ac').value.trim(),acs:document.getElementById('f-acs').value.trim(),mfr:mfrV,reg:document.getElementById('f-reg').value.trim().toUpperCase(),h:h,km:km,comment:document.getElementById('f-comment').value.trim(),user_id:currentUser?currentUser.id:null};
  setSyncStatus('syncing','SAVING...');
  sb.from('flights').insert([newFlight]).select().then(function(res){
    if(res.error){showToast('Save failed: '+res.error.message,true);setSyncStatus('error','ERROR');return;}
    flightData.push(res.data[0]);
    ['f-date','f-fn','f-dep','f-arr','f-ac','f-acs','f-reg','f-h-hrs','f-h-min','f-km','f-comment','f-airline-other','f-mfr-other'].forEach(function(id){document.getElementById(id).value='';});
    document.getElementById('f-airline').value='';document.getElementById('f-mfr').value='';
    document.getElementById('airlineOtherWrap').style.display='none';document.getElementById('mfrOtherWrap').style.display='none';
    closeModal();renderAll();setSyncStatus('connected','SYNCED');showToast('Flight added and saved to cloud!');
  });
});
    closeModal();renderAll();setSyncStatus('connected','SYNCED');showToast('Flight added and saved to cloud!');
  });
});

// ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openConfirm(id,n){
  var f=flightData.find(function(x){return String(x.id)===String(id);});
  if(!f)return;
  pendingDeleteId=id;
  document.getElementById('confirmMsg').textContent='Delete '+f.fn+' ('+f.dep+' ‚Üí '+f.arr+') on '+f.date+'?';
  document.getElementById('confirmOverlay').classList.add('open');
}
function closeConfirm(){pendingDeleteId=null;document.getElementById('confirmOverlay').classList.remove('open');}
document.getElementById('confirmCancelBtn').addEventListener('click',closeConfirm);
document.getElementById('confirmOverlay').addEventListener('click',function(e){if(e.target===this)closeConfirm();});
document.getElementById('confirmDeleteBtn').addEventListener('click',function(){
  if(pendingDeleteId===null)return;
  var fn=flightData.find(function(f){return String(f.id)===String(pendingDeleteId);});
  var fnName=fn?fn.fn:'flight';
  setSyncStatus('syncing','DELETING...');
  sb.from('flights').delete().eq('id',pendingDeleteId).then(function(res){
    if(res.error){showToast('Delete failed: '+res.error.message,true);setSyncStatus('error','ERROR');return;}
    flightData=flightData.filter(function(f){return String(f.id)!==String(pendingDeleteId);});
    closeConfirm();renderAll();setSyncStatus('connected','SYNCED');showToast(fnName+' deleted.');
  });
});

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var guestMode=false;
var currentUser=null;
var authMode='login';

function switchAuthTab(mode){
  authMode=mode;
  var isLogin=mode==='login';
  document.getElementById('authTabLogin').style.background=isLogin?'var(--cyan)':'var(--card)';
  document.getElementById('authTabLogin').style.color=isLogin?'var(--black)':'var(--text-dim)';
  document.getElementById('authTabLogin').style.fontWeight=isLogin?'700':'400';
  document.getElementById('authTabSignup').style.background=isLogin?'var(--card)':'var(--cyan)';
  document.getElementById('authTabSignup').style.color=isLogin?'var(--text-dim)':'var(--black)';
  document.getElementById('authTabSignup').style.fontWeight=isLogin?'400':'700';
  document.getElementById('pwSubmit').textContent=isLogin?'LOG IN':'CREATE ACCOUNT';
  document.getElementById('authNameWrap').style.display=isLogin?'none':'block';
  document.getElementById('pwError').textContent='';
}

function showAuthError(msg){
  document.getElementById('pwError').textContent=msg;
  document.getElementById('authPassword').classList.add('err');
  setTimeout(function(){document.getElementById('authPassword').classList.remove('err');},600);
}

function hideAuthScreen(){
  var el=document.getElementById('pwScreen');
  el.style.transition='opacity 0.4s';
  el.style.opacity='0';
  setTimeout(function(){el.style.display='none';},400);
}

document.getElementById('pwSubmit').addEventListener('click',handleAuth);
document.getElementById('authPassword').addEventListener('keydown',function(e){if(e.key==='Enter')handleAuth();});
document.getElementById('pwToggle').addEventListener('click',function(){
  var inp=document.getElementById('authPassword');
  inp.type=inp.type==='password'?'text':'password';
});

async function handleAuth(){
  var email=document.getElementById('authEmail').value.trim();
  var password=document.getElementById('authPassword').value;
  var name=document.getElementById('authName').value.trim();
  if(!email||!password){showAuthError('Please enter email and password');return;}
  document.getElementById('pwSubmit').textContent='...';
  document.getElementById('pwSubmit').disabled=true;
  try{
    var res;
    if(authMode==='login'){
      res=await sb.auth.signInWithPassword({email:email,password:password});
      if(res.error) throw res.error;
    } else {
      if(!name){showAuthError('Please enter your name');document.getElementById('pwSubmit').textContent='CREATE ACCOUNT';document.getElementById('pwSubmit').disabled=false;return;}
      res=await sb.auth.signUp({email:email,password:password,options:{data:{full_name:name}}});
      if(res.error) throw res.error;
      if(!res.data.session){showAuthError('Check your email to confirm your account');document.getElementById('pwSubmit').textContent='CREATE ACCOUNT';document.getElementById('pwSubmit').disabled=false;return;}
    }
    currentUser=res.data.user;
    var displayName=currentUser.user_metadata&&currentUser.user_metadata.full_name?currentUser.user_metadata.full_name:email.split('@')[0];
    document.getElementById('headerSub').textContent=displayName.toUpperCase()+"'S FLIGHT LOG";
    hideAuthScreen();
    init();
  } catch(err){
    showAuthError(err.message||'Authentication failed');
    document.getElementById('pwSubmit').textContent=authMode==='login'?'LOG IN':'CREATE ACCOUNT';
    document.getElementById('pwSubmit').disabled=false;
  }
}

async function handleLogout(){
  await sb.auth.signOut();
  sessionStorage.clear();
  flightData=[];filtered=[];
  currentUser=null;
  document.getElementById('pwScreen').style.display='flex';
  document.getElementById('pwScreen').style.opacity='1';
  document.getElementById('authEmail').value='';
  document.getElementById('authPassword').value='';
  document.getElementById('pwError').textContent='';
  document.getElementById('pwSubmit').textContent='LOG IN';
  document.getElementById('pwSubmit').disabled=false;
  switchAuthTab('login');
}

// Check for existing session on load
(async function(){
  var session=await sb.auth.getSession();
  if(session.data&&session.data.session&&session.data.session.user){
    currentUser=session.data.session.user;
    var displayName=currentUser.user_metadata&&currentUser.user_metadata.full_name?currentUser.user_metadata.full_name:currentUser.email.split('@')[0];
    document.getElementById('headerSub').textContent=displayName.toUpperCase()+"'S FLIGHT LOG";
    hideAuthScreen();
    init();
  }
})();

// ‚îÄ‚îÄ EXPORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('exportBtn').addEventListener('click',function(){
  if(!flightData.length){showToast('No flights to export',true);return;}

  // Build CSV
  var headers=['#','Date','Airline','Flight Number','Departing','Arriving','Aircraft','Aircraft Short','Manufacturer','Registration','Duration (h)','Distance (km)','Comments'];
  var rows=flightData.map(function(f){
    return [f.n,f.date,f.airline,f.fn,f.dep,f.arr,f.ac,f.acs,f.mfr,f.reg,f.h,f.km,'"'+(f.comment||'').replace(/"/g,'""')+'"'].join(',');
  });
  var csv=[headers.join(',')].concat(rows).join('\n');

  // Also build JSON backup
  var json=JSON.stringify(flightData,null,2);

  // Download CSV
  var blob=new Blob([csv],{type:'text/csv'});
  var a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='flightdeck_'+new Date().toISOString().slice(0,10)+'.csv';
  a.click();
  URL.revokeObjectURL(a.href);

  // Download JSON after short delay
  setTimeout(function(){
    var blob2=new Blob([json],{type:'application/json'});
    var a2=document.createElement('a');
    a2.href=URL.createObjectURL(blob2);
    a2.download='flightdeck_'+new Date().toISOString().slice(0,10)+'.json';
    a2.click();
    URL.revokeObjectURL(a2.href);
  },500);

  showToast('Exported '+flightData.length+' flights as CSV + JSON!');
});

// ‚îÄ‚îÄ INIT: Load from Supabase ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function init(){
  setLoading(20,'CONNECTING TO DATABASE...');
  setSyncStatus('syncing','CONNECTING');
  try{
    setLoading(50,'LOADING YOUR FLIGHTS...');
    var res=await sb.from('flights').select('*').order('n',{ascending:true});
    if(res.error) throw res.error;
    flightData=res.data;
    setLoading(100,'READY!');
    setSyncStatus('connected','SYNCED');
    setTimeout(function(){
      hideLoading();
      renderAll();
      renderMap();
    },400);
  } catch(err){
    setLoading(100,'CONNECTION ERROR');
    setSyncStatus('error','ERROR');
    document.getElementById('loadingMsg').style.color='var(--red)';
    setTimeout(function(){hideLoading();},1000);
    showToast('Could not load flights: '+err.message,true);
  }
}

// ‚îÄ‚îÄ TRENDS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderTrends(data){
  if(!data.length) return;
  var MONTHS=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  var alColors={American:'#cc0000',United:'#005daa',Delta:'#c01933',Southwest:'#f5a623',Frontier:'#00a94f',Emirates:'#d71921',IndiGo:'#1a0dab',Qatar:'#5c0632'};
  var palette=['#00d4ff','#f59e0b','#10b981','#a78bfa','#f87171','#60a5fa','#34d399','#fb923c','#c084fc','#e879f9'];

  // ‚îÄ‚îÄ Flights per month bar chart ‚îÄ‚îÄ
  var byMonth={};
  data.forEach(function(f){
    var d=parseFlightDate(f.date);if(isNaN(d.getTime()))return;
    var key=d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0');
    byMonth[key]=(byMonth[key]||0)+1;
  });
  var monthKeys=Object.keys(byMonth).sort();
  var maxM=Math.max.apply(null,Object.values(byMonth))||1;
  var BAR_H=140;
  document.getElementById('chartMonthly').innerHTML=monthKeys.map(function(k){
    var cnt=byMonth[k],parts=k.split('-'),px=Math.max(4,Math.round((cnt/maxM)*BAR_H));
    var lbl=MONTHS[parseInt(parts[1])-1]+" '"+parts[0].slice(2);
    return '<div class="bar-col"><div class="bar-fill" style="height:'+px+'px;background:var(--cyan)" title="'+lbl+': '+cnt+' flights"></div><div class="bar-label">'+lbl+'</div><div class="bar-val">'+cnt+'</div></div>';
  }).join('');

  // ‚îÄ‚îÄ Miles over time (cumulative line chart) ‚îÄ‚îÄ
  var sorted=[].concat(data).sort(function(a,b){return parseFlightDate(a.date)-parseFlightDate(b.date);});
  var cumMi=0,points=sorted.map(function(f){cumMi+=Math.round(f.km*0.621371);return cumMi;});
  var maxP=points[points.length-1]||1;
  var W=600,H=140,pad=10;
  var svgPts=points.map(function(p,i){
    var x=pad+(i/(points.length-1||1))*(W-pad*2);
    var y=H-pad-(p/maxP)*(H-pad*2);
    return x.toFixed(1)+','+y.toFixed(1);
  }).join(' ');
  var fillPts=''+pad+','+H+' '+svgPts+' '+(W-pad)+','+H;
  document.getElementById('svgMiles').setAttribute('viewBox','0 0 '+W+' '+H);
  document.getElementById('svgMiles').innerHTML='<defs><linearGradient id="lg" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00d4ff" stop-opacity="0.3"/><stop offset="100%" stop-color="#00d4ff" stop-opacity="0"/></linearGradient></defs><polygon points="'+fillPts+'" fill="url(#lg)"/><polyline points="'+svgPts+'" fill="none" stroke="#00d4ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><text x="'+pad+'" y="'+(H-2)+'" font-family="monospace" font-size="9" fill="#7b8fa8">0</text><text x="'+(W-pad)+'" y="'+(H-2)+'" font-family="monospace" font-size="9" fill="#7b8fa8" text-anchor="end">'+cumMi.toLocaleString()+' mi</text>';

  // ‚îÄ‚îÄ Airline loyalty donut ‚îÄ‚îÄ
  var alCounts={};data.forEach(function(f){alCounts[f.airline]=(alCounts[f.airline]||0)+1;});
  var alSorted=Object.entries(alCounts).sort(function(a,b){return b[1]-a[1];});
  var total=data.length,cx=70,cy=70,R=54,r=34,startAngle=-Math.PI/2;
  var donutPaths='',legendHtml='';
  alSorted.forEach(function(e,i){
    var al=e[0],cnt=e[1],pct=cnt/total;
    var angle=pct*2*Math.PI,endAngle=startAngle+angle;
    var x1=cx+R*Math.cos(startAngle),y1=cy+R*Math.sin(startAngle);
    var x2=cx+R*Math.cos(endAngle),y2=cy+R*Math.sin(endAngle);
    var xi1=cx+r*Math.cos(startAngle),yi1=cy+r*Math.sin(startAngle);
    var xi2=cx+r*Math.cos(endAngle),yi2=cy+r*Math.sin(endAngle);
    var lg=angle>Math.PI?1:0;
    var col=alColors[al]||palette[i%palette.length];
    donutPaths+='<path d="M'+xi1.toFixed(1)+' '+yi1.toFixed(1)+' L'+x1.toFixed(1)+' '+y1.toFixed(1)+' A'+R+' '+R+' 0 '+lg+' 1 '+x2.toFixed(1)+' '+y2.toFixed(1)+' L'+xi2.toFixed(1)+' '+yi2.toFixed(1)+' A'+r+' '+r+' 0 '+lg+' 0 '+xi1.toFixed(1)+' '+yi1.toFixed(1)+'Z" fill="'+col+'" opacity="0.9"/>';
    legendHtml+='<div class="donut-item"><div class="donut-dot" style="background:'+col+'"></div><span>'+al+'</span><span class="donut-pct">'+Math.round(pct*100)+'%</span></div>';
    startAngle=endAngle;
  });
  document.getElementById('svgDonut').innerHTML=donutPaths+'<text x="70" y="66" text-anchor="middle" font-family="sans-serif" font-size="18" font-weight="700" fill="var(--text)">'+total+'</text><text x="70" y="80" text-anchor="middle" font-family="monospace" font-size="9" fill="var(--text-dim)">flights</text>';
  document.getElementById('donutLegend').innerHTML=legendHtml;

  // ‚îÄ‚îÄ Busiest months heatmap ‚îÄ‚îÄ
  var monthTotals=new Array(12).fill(0);
  data.forEach(function(f){var d=parseFlightDate(f.date);if(!isNaN(d.getTime()))monthTotals[d.getMonth()]+=1;});
  var maxHeat=Math.max.apply(null,monthTotals)||1;
  document.getElementById('heatmap').innerHTML=MONTHS.map(function(m,i){
    var cnt=monthTotals[i],intensity=cnt/maxHeat;
    var bg='rgba(0,212,255,'+( 0.08+intensity*0.82)+')';
    var col=intensity>0.5?'#080b12':'var(--text)';
    return '<div class="heat-cell" style="background:'+bg+';color:'+col+'" title="'+m+': '+cnt+' flights"><div style="font-size:0.6rem;font-weight:600">'+m+'</div><div>'+cnt+'</div></div>';
  }).join('');

  // ‚îÄ‚îÄ Year-over-year ‚îÄ‚îÄ
  var byYear={};
  data.forEach(function(f){
    var d=parseFlightDate(f.date);if(isNaN(d.getTime()))return;
    var y=d.getFullYear();
    if(!byYear[y])byYear[y]={flights:0,miles:0};
    byYear[y].flights++;byYear[y].miles+=Math.round(f.km*0.621371);
  });
  document.getElementById('yoyGrid').innerHTML=Object.keys(byYear).sort().map(function(y){
    return '<div class="yoy-card"><div class="yoy-year">'+y+'</div><div class="yoy-flights">'+byYear[y].flights+'</div><div class="yoy-miles">'+byYear[y].miles.toLocaleString()+' mi &middot; flights</div></div>';
  }).join('');

  // ‚îÄ‚îÄ Longest/shortest leaderboard ‚îÄ‚îÄ
  var sortedByDist=[].concat(data).sort(function(a,b){return b.km-a.km;});
  document.getElementById('lbLongest').innerHTML=sortedByDist.slice(0,5).map(function(f,i){
    return '<div class="lb-item"><div class="lb-rank">#'+(i+1)+'</div><div class="lb-route">'+f.dep+' ‚Üí '+f.arr+'</div><div class="lb-detail">'+Math.round(f.km*0.621371).toLocaleString()+' mi &middot; '+fmtH(f.h)+'</div></div>';
  }).join('');
  document.getElementById('lbShortest').innerHTML=sortedByDist.slice(-5).reverse().map(function(f,i){
    return '<div class="lb-item"><div class="lb-rank">#'+(i+1)+'</div><div class="lb-route">'+f.dep+' ‚Üí '+f.arr+'</div><div class="lb-detail">'+Math.round(f.km*0.621371).toLocaleString()+' mi &middot; '+fmtH(f.h)+'</div></div>';
  }).join('');

  // ‚îÄ‚îÄ Most visited airports ‚îÄ‚îÄ
  var apCnts={};
  data.forEach(function(f){apCnts[f.dep]=(apCnts[f.dep]||0)+1;apCnts[f.arr]=(apCnts[f.arr]||0)+1;});
  var apSorted=Object.entries(apCnts).sort(function(a,b){return b[1]-a[1];}).slice(0,10);
  var maxAp=apSorted[0]?apSorted[0][1]:1;
  document.getElementById('lbAirports').innerHTML=apSorted.map(function(e,i){
    var code=e[0],cnt=e[1],ap=AIRPORTS[code];
    return '<div class="ap-rank-item"><div class="ap-rank-code">'+code+'</div><div class="ap-rank-name">'+(ap?ap.name:code)+'</div><div class="ap-rank-bar"><div class="ap-rank-fill" style="width:'+(cnt/maxAp*100).toFixed(1)+'%"></div></div><div class="ap-rank-cnt">'+cnt+'</div></div>';
  }).join('');
}

// init() is called by the auth system after successful login
</script>
</body>
</html>
